---
title: "Extra Visualizations and Analyses"
author: "Dylan Glave"
date: "11/18/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(janitor)
library(tidyverse)
library(ggplot2)
library(kableExtra)
library(knitr)
library(naniar)
library(here)
library(dplyr)
library(scales)
library(stringr)
library(plotly)
library(foreign)
library(nnet)
library(reshape2)
library(vtable)
library(stargazer)
library(viridis)
library(NbClust)
library(car)
library(corrplot)
library(RColorBrewer)
library(forcats)
library(viridis)

```

## R Markdown

OK, so! 


In our `full_analysis.Rmd` there is a TON of semi-related work. Some of that work (although great) is superfluous to the Cluster Analysis focus. In order to keep things organized, I'll be moving chunks of that Rmd to.....you guessed it, this one! 

Starting with the Bar Plots for each Engagement and Agreement question. 
**The relevant data is stored in `scaled_sum.csv`**

###### Reading in the data mentioned above

```{r, include=FALSE}
scaled_sum <- read_csv("scaled_sum.csv")
```

###### Bar Graphs for each A & E Question

**Engagement** 


1. Question 44

```{r}

x44_counts <- scaled_sum %>% 
 count(x44_meeting_attendance)

ggplot(data = x44_counts,
       aes(x = x44_meeting_attendance, y = n)) +
 geom_bar( stat="identity", fill="goldenrod") +
  theme_bw()
```
*Question 44:  Mean = 0.138, but nearly all respondents said Yes or No. Around 1200 responses did not attend meetings, will around 1600 do attend.*

**Question 45**

```{r}
x45_counts <- scaled_sum %>% 
 count(x45_leadership_position)

ggplot(data = x45_counts,
       aes(x = x45_leadership_position, y = n)) +
 geom_bar( stat="identity", fill="red3") +
  theme_bw()
```
*Question 45: Mean = -0.551. This mean shows that 3/4 of fishers responded "No" Few fisher households included someone with a leadership position within the fishery.*


**Question 48**

```{r}

x48_counts <- scaled_sum %>% 
 count(x48_enforcement_participation)

ggplot(data = x48_counts,
       aes(x = x48_enforcement_participation, y = n)) +
 geom_bar( stat="identity", fill="chartreuse1") +
  theme_bw()
```
*Question 48: Mean = -0.492. Nearly 3 out of 4 fishers do not participate in enforcement.*


A quick pause from graphs! 

Let's see the combination counts for question 45 and 48

```{r}
counts_45_48 <- scaled_sum %>% 
  count(x45_leadership_position, x48_enforcement_participation)
```
- Leaders who don't enforce: 192
- Enforcement volunteers without leadership roles: 250
- Households who do both: 283
-Households who no neither: 1770


```{r}
x53_counts <- scaled_sum %>% 
 count(x53_encourage_regulations)

ggplot(data = x53_counts,
       aes(x = x53_encourage_regulations, y = n)) +
 geom_bar( stat="identity", fill="lightblue") +
  theme_bw()
```
*Question 53: Mean = -0.071. This is just below the "neutral" survey option. We see a very similar totals in the "strongly agree" and "strongly disagree." Our mean skews negative because around 100 more fishers wrote "disagree" relative to "agree."*    




```{r}
x61g_counts <- scaled_sum %>% 
 count(x61g_fishing_change_behavior)

ggplot(data = x61g_counts,
       aes(x = x61g_fishing_change_behavior, y = n)) +
 geom_bar( stat="identity", fill="seagreen2") +
  theme_bw()
```
*Question 61(g) mean = 3.955. This is the first mean that really skews high. With a mode of 4, most respondents were at least "willing" to change their fishing behavior for the reserve structure.*

Here's a check for normal distrbution: 
It looks pretty normal, even with the high amount of "4" responses
```{r}
qqnorm(scaled_sum$x61g_fishing_change_behavior, pch = 1, frame = FALSE)
qqline(scaled_sum$x61g_fishing_change_behavior, col = "steelblue", lwd = 2)

```



*Moving onto Agreement* 

```{r}


x43_counts <- scaled_sum %>% 
 count(x43_ma_benefits)

ggplot(data = x43_counts,
       aes(x = x43_ma_benefits, y = n)) +
 geom_bar( stat="identity", fill="slateblue2") +
  theme_bw()
```
*43:  Mean  = 0.556. Nearly no one answered with the negative response.*





```{r}
x46_counts <- scaled_sum %>% 
 count(x46_represent_interests)

ggplot(data = x46_counts,
       aes(x = x46_represent_interests, y = n)) +
 geom_bar( stat="identity", fill="mediumorchid2") +
  theme_bw()
```
 *Question 46: Mean = 0.667. Huge skew towards the positive response. 
 




We saw that variables 46 and 47 are highly correlated, and have similar wording. We find them to NOT be independent from one another, and exclude 47 from the index of Agreement.


```{r}
x52_counts <- scaled_sum %>% 
 count(x52_ma_benefit_5yrs)

ggplot(data = x52_counts,
       aes(x = x52_ma_benefit_5yrs  , y = n)) +
 geom_bar( stat="identity", fill="olivedrab3") +
  theme_bw()


```
*Question 52: Mean = 0.506. For the first time, we see a lot of "unsure" answers. This likely has to do with uncertainty in projecting 5 years in the future. 

```{r}
x61a_counts <- scaled_sum %>% 
 count(x61a_current_regulations)

ggplot(data = x61a_counts,
       aes(x = x61a_current_regulations, y = n)) +
 geom_bar( stat="identity", fill="springgreen3") +
  theme_bw()
```
*Question 61(a): Mean = 3.93, clear positive skew, and the mean seems to represent the mode and median*




```{r}
x61f_counts <- scaled_sum %>% 
 count(x61f_rights_distribution_fair)

ggplot(data = x61f_counts,
       aes(x =x61f_rights_distribution_fair, y = n)) +
 geom_bar( stat="identity", fill="skyblue") +
  theme_bw()
```
*61(f): Mean = 3.805. More neutral responses that strongly agree, but very few disagreeing fishers.* 



```{r}
x62_counts <- scaled_sum %>% 
 count(x62_reserve_compliance)

ggplot(data = x62_counts,
       aes(x =x62_reserve_compliance, y = n)) +
 geom_bar( stat="identity", fill="indianred4") +
  theme_bw()
```
Question 62: Mean = 0.525

We do NOT include this question in the index, but will use it to create a graph of "admitting noncompliance" 



```{r}
x64_counts <- scaled_sum %>% 
 count(x64_wrong_fishing_reserve)

ggplot(data = x64_counts,
       aes(x =x64_wrong_fishing_reserve, y = n)) +
 geom_bar( stat="identity", fill="chocolate4") +
  theme_bw()
```
*Question 64: Mean = 3.957. Another mean between 3 and 4, with very small numbers of below-neutral responses*






For now, I run the clusters, and we can go back. 





Now that these clusters are attached to each observation, let's visualize it 

```{r, include = FALSE}

ggplot(engagement_cl) +
geom_point(aes(x = agree_mean, y = eng_mean, color = cluster_no),
           size = 0.7) +
labs( x = "Agreement (Scaled across 5 Questions)",
    y = "Engagement (Scaled across 5 Questions)",
    title = "Mapping Clusters of Engagement",
    color = "Cluster") +
scale_x_continuous(limits = c(-3, 2),
                   breaks = c(-2, -1, 0, 1, 2)) +
 scale_y_continuous(limits = c(-1.5, 2),
                   breaks = c( -1, 0, 1, 2))

```
This is great, let's map them over country and reserve as well. 



##### UNSCALED K-Means Clustering (Was in use, up until 11/17/21)
```{r}

unscaled_agree_engage_only <- scaled_sum %>% 
  select(24:33)

# NbClust(unscaled_agree_engage_only[1:10], min.nc = 2, max.nc = 8, method = "kmeans")


set.seed(1)

 agreement_engagement_km <- kmeans(unscaled_agree_engage_only, 5)

## The 5 means the amount of clusters we're looking at


  agreement_engagement_km

  

 unscaled_table_df <- data.frame(agreement_engagement_km$size, agreement_engagement_km$centers)

 


  km_table_means <- unscaled_table_df %>% 
    select(!agreement_engagement_km.size)

kmeans_kable <- head(km_table_means) %>% 
kable( format = "html", caption = "Summary of Clusters") %>%
   kable_styling(bootstrap_options = "striped",
                full_width = F,
                position = "left") %>%
collapse_rows(columns = 3, valign = "middle")


kmeans_kable

```


```{r}

unscaled_cluster_df <- data.frame(scaled_sum, cluster_no = factor(agreement_engagement_km$cluster))


#### Below is a summary df that shows all the means

mean_cluster_df <- unscaled_cluster_df %>%
        group_by(cluster_no) %>%
        summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))

cluster_counts <- unscaled_cluster_df %>%
  count(cluster_no)



ggplot() +
  geom_point(data = unscaled_cluster_df,
       aes(x = agree_mean, y = eng_mean,
           color = cluster_no),
           size = 0.7, alpha = 0.7) +
  geom_point(data = mean_cluster_df,
             aes(x = agree_mean, y = eng_mean,
          color = cluster_no),
           size = 6, shape = "triangle", show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mapping Clusters",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))

```


Agreement Clustering
```{r}
agreement_km <- kmeans(agree_scaled_sum, 3)

 agreement_km

# 9 of 23 algorithms saw 3 clusters, we're going to run with that

# K-means clustering with 3 clusters of sizes 873, 1444, 797

# Binding the cluster numbers to the observation
```

```{r}
 agree_cl <- data.frame(scaled_sum, cluster_no = factor(agreement_km$cluster))
```

Linear Regression that is on hold:
```{r, include=FALSE}
# 
#   eng_regression_1 <- lm(data = scaled_sum,
#                             eng_mean ~ x50_ma_punishment + 
#                               x40_reserve_boundaries_aware)
# summary(eng_regression_1)
# 
# 
# ### Let's do one with 3 ecological outcomes: 19, 22, 23
# 
# eng_regression_2 <-  lm(data = scaled_sum,
#                             eng_mean ~ x19_current_fish_catch + x22_catch_5yrs + x23_job_secure)
# 
# summary(eng_regression_2)
# 
# ## Here out outcome is a Z-score. with ordinal inputs, should we switch to 1-5? 
```



```{r}
# eng_regression_3 <-  lm(data = scaled_sum,
#                             eng_mean ~ x38_reserve_fishing_allowed + x39_ma_boundaries_aware + x40_reserve_boundaries_aware)
# 
# summary(eng_regression_3)
```

I'll come back to the regression. 

#### The Notes below are from the non `scale()` clusters. We're no longer using them, but I'll keep the notes down here as an appendix. 

There are 5 clusters! 

Sizes: 701  842  936 1350  620

##### Comparing clusters 
1 and 2 seem similar, with high levels of A and E
- 44: 0.44 (C1) and 0.86 (C2) Cluster 2 attends more meetings
- 45 is a big swing, cluster 2 is 0.87, and C1 is -0.85. These are the leaders!
- 48: -0.44 and 0.35 is a decent difference in enforcement
BUT C1 is more likely to encourage regulations (1.21 v 0.5)
-61 is closer (4.5 and 4.1)

Within agreement they're more similar. but C1 is higher average in each of the 5 questions. Less leaders, but agree more across the board. 


*3 and 4* 
- 44: C3 has a 0.97, and C4 has a -0.97
45 is similar (within .01)
Same for 48
53 (encourage regulations) is -0.7 (C3) and -0.29 (C4)
61g change behavior C3 is the 2nd lowest at 3.7, and c4 is in third at 4.05
Within agreement, they're averages are similar across all questions, with C3 a little bit lower for most, except ma_benefits 

More than anything, C3 ATTENDS a whole lot more than C4. 
but C3 is the least likely of any group to encourage regulations. Perhaps we're seeing creative fishers here


C5 is looking at 2/5 for questions 61a and 61f, and is also by far the lowest for 46 and 52. within agreement, only in MA benefits are they somewhat close to other clusters. They do have a few more leaders than other clusters though. But overall, very much not attending

*Cluster 1* 
 Only 1 observation is below -1 in agreement. Most of the *fully-agreeing* fishers are in cluster two - but not all! It excludes the agreeing, but rather unengaged fishers. Similarly, it omits the super-engaged. We can describe C1 (so far) as fishers who are very on board with rules, but are a bit above average engagement. 
Centers = (0.448207772, 0.3930240) (Agreement, Engagement)
N = 701


*Cluster 2* 
These are all the *super-engaged* fishers. Agreement ranges from 1 (the maximum) to -1.4. 
Center = (0.156193496, 0.8606600) (Agreement, Engagement) 
N = 842

*Cluster 3*
This is the largest spread of any cluster. We have some fully-agreeing fishers, and at least 1 or 2 with agreement below 1.5. Engagement grows up to 1.5, which is mostly reserved for the high-engaging clusters. With means SO close to 0, we see this as a the most average cluster. A bit less engaged, and agreeing with as much as the average fisher from the study. 
Center = (0.002805289, -0.1748106) (Agreement, Engagement)
N = 936


*Cluster 4* 
Its center is very close to Cluster 3, but we can see clear differences when we look at the spread. These folks do NOT engage. While there as unengaged as the Resistant fishers, but most actually agree quite a lot. This includes some with A = 1, the max. 
Center = (0.052635489, -0.4098127) (Agreement, Engagement)
N = 1350, largest cluster



*Cluster 5 - Resistant*
This is the classically known group of unengaged, disagreeing fishers. Many of the outliers are from Honduras, but the country variable doesn't explain the entire cluster. They all disagree, but to varying levels. We'll look at their distinguishing characteristics. 
Center = (-0.837729407, -0.4569608) (Agreement, Engagement)
N = 620, smallest cluster. 


### Section B - More visualizations with Clusters 

I've made heaps of visualizations to understand where we see variation between Clusters and where we do not (both can be insightful!)


##### B1. Boat Ownership + Clusters 

Hypothesis: Fishers without boats are less engaged.
```{r} 
boat_ownership <- scaled_km_df %>% 
  select(eng_mean, agree_mean, x21_boat_owner_status, cluster_no, x23_job_secure, country, x49_enforcement_responsible, x11d_income_fishing_industrial, x11c_income_fishing_artisanal)

boat_counts <- boat_ownership %>% 
  group_by(cluster_no) %>% 
  count(x21_boat_owner_status)


ggplot(boat_counts,
       aes(x = x21_boat_owner_status, y = n, fill = cluster_no)) +
  geom_bar(position="fill", stat="identity") +
  labs( x = "Boat Ownshership",
      y = "Cluster",
      title = "Oh, you got a boat?", 
      color = "Cluster") +
    guides(colour = guide_legend(override.aes = list(size=7))) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
```


- When the collective owns a boat, C4 dominates, C2 (super-engaged) shrinks
- When fishers share boats "as an employee" (meaning their boss owns a boat?) there are more resistant fishers. 
- Fishers who own their own boat have a larger contingent of Cluster 1
- Renters are the most "super-engaged" (C2) and least resistant (C5)

Let's break this down by country, to check if boat status and country are heavily correlated 

```{r} 

boats_by_country <- boat_ownership %>% 
  filter(country != "PHL") %>% 
  group_by(x21_boat_owner_status) %>% 
  count(country)

ggplot(boats_by_country,
       aes(x = x21_boat_owner_status, y = n, fill = country)) +
  geom_bar(position="fill", stat="identity") +
  labs( x = "Boat Ownshership",
      y = "Country",
      title = "Who got boats?", 
      color = "Country") +
    guides(colour = guide_legend(override.aes = list(size=7))) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))

```
A lot of renting on Honduras! 
Mozambique and Brazil have a lot of collective ownership 
Brazil also has a lot of boat owners 
Mozambique has the highest percentage of fishers who fish without boats, even more than Brazil (where I know many fishers collect crabs and other invertebrates)


###### B2. Seafood Dependence
Let's see how people who are dependent on seafood comply: 
Note: NOT in use for any active analysis
```{r} 

seafood_clean <- food_security %>% 
  drop_na(x60_hh_fish_consumption)

ggplot(seafood_clean,
       aes(x = agree_mean, y = eng_mean, color = x60_hh_fish_consumption)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Seafood Dependence", 
      color = "Cluster", 
      caption = "Hypothesis: People who eat more fish are more engaged") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7))) 



seafood_counts <- seafood_clean %>% 
  group_by(cluster_no) %>% 
  count(x60_hh_fish_consumption) %>% 
 pivot_wider(names_from = cluster_no, values_from = n) 
```


###### B3. Perceived Catch, By Country

I just want to check the counts of x19 by country
```{r} 

no_na_19 <- scaled_km_df %>% 
    drop_na(x19_current_fish_catch) %>% 
 mutate(x19_current_fish_catch = recode_factor(x19_current_fish_catch, 
    "Declined a lot" = "1. Declined a lot",
          "Declined slightly" = "2. Declined slightly",
           "Stayed the same" = "3. Stayed the same",
          "Improved slightly" = "4. Improved slightly",
          "Improved heavily" = "5. Improved heavily")) 

x19_by_country <- no_na_19 %>% 
  group_by(country) %>% 
  count(x19_current_fish_catch)

ggplot(x19_by_country) +
  geom_bar( aes(x = country, y=n, fill = x19_current_fish_catch), stat="identity", alpha=0.8) +
  theme_bw() +
  labs(fill = "Perceived Fish Catch")

x19_sans_phl <- no_na_19 %>% 
  filter(country != "PHL") %>% 
    group_by(country) %>% 
  count(x19_current_fish_catch)

ggplot(x19_sans_phl) +
  geom_bar( aes(x = country, y=n, fill = x19_current_fish_catch), stat="identity", alpha=0.8) +
  theme_bw() +
  labs(fill = "Perceived Fish Catch")
```

###### B4. Question 64, Morality of breaking rules

Clusters with question 64: How wrong is fishing in the reserve? 

```{r}
 
three_part_64 <- scaled_km_df %>% 
  mutate(x64_wrong_fishing_reserve = recode_factor(x64_wrong_fishing_reserve, 
                                        "5" = "Very Wrong",
                                        "4" = "Very Wrong",
                                        "3" = "Slightly Wrong", 
                                        "2" = "Slightly Wrong",
                                        "1" = "Not Wrong",
                                        "0" = "Not Wrong")) 

ggplot() +
  geom_point(data = three_part_64,
       aes(x = agree_mean, y = eng_mean,
           color = cluster_no, shape = x64_wrong_fishing_reserve), size = 1.1, alpha = 0.8) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mapping Clusters",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7))) 

```


So, kind of everyone thinks its pretty wrong, huh. Also a ton of NAs, hard to limit that noise


###### B5. Clusters and 63, admitted rule-breakers
```{r}

x63_clusters <- scaled_km_df %>% 
  filter(x63_fishing_in_reserve == "1")

 
x63_means <- x63_clusters %>% 
  select(eng_mean, agree_mean) %>% 
  drop_na()  
  st(x63_means) 


ggplot(data = x63_clusters, aes(x = agree_mean, y = eng_mean,
           color  = x64_wrong_fishing_reserve),
           size = 0.7, alpha = 0.7) +
  geom_point(size = 1) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mapping Clusters of Rule-breakers",
      color = "Morality") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7))) 



```

###### B6. Jitter Plot of Engagement and Clusters

This helps visualize points of densities among Clusters
```{r}
ggplot(data = scaled_km_df,
       aes(x = country, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.4) +
  geom_jitter(size = 0.4) +
   guides(colour = guide_legend(override.aes = list(size=7)))

```
Notes: 
- Resistant fishers are far more present in BRA, HND and PHL. However, HND and BRA both spread from the lowest to highest engagement possibilities. This mean there is OPPORTUNITY to be a leader, enforce, etc. 


###### B7. Clusters and Gender
```{r}

gender_mean <- scaled_km_df %>% 
  group_by(x6_gender) %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))


ggplot() +
  geom_jitter(data = scaled_km_df, 
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(data = gender_mean, 
            aes(x = agree_mean, y = eng_mean), color = "black", size = 7, alpha = 0.6) +
   guides(colour = guide_legend(override.aes = list(size=7))) +
  facet_wrap(~x6_gender) 

```
Female mean = (-0.06947793, -0.03637067)

Male mean =  (0.04032597, 0.02179388)

This was not the case before! Were all within 0.1 of zero, to be clear. But when we add Brazil, the mean for men increases


###### B8. Clusters and Question 4

```{r} 
q_4_clustered <- scaled_km_df %>% 
  select(x4_ma_r_mb, cluster_no, eng_mean, agree_mean) %>% 
  drop_na(x4_ma_r_mb) %>% 
 group_by(cluster_no) %>% 
  count(x4_ma_r_mb)

ggplot(q_4_clustered) +
  geom_bar( aes(x = x4_ma_r_mb, y=n, fill = cluster_no), stat="identity", alpha=0.8) +
  theme_bw() +
  labs(fill = "MA Status")

```
Most places have "all 3," when they've answered all of our compliance questions. 


###### B9. Household Demographics (Question 7 with subquestions)

##### Household Demographics (Question 7)
Filed in... `side_analysis_and_viz`

I'll first make a df that includes all of subquestions of Q7. 
```{r} 
question_7_analysis <- scaled_km_df %>% 
  select(cluster_no, agree_mean, eng_mean, x70_hh_average_income, x7_gender, x7_age, x7_relationship, x7_education, household_size)
```


```{r}
q7_reordered <- question_7_analysis %>% 
  arrange(cluster_no)

fish_treeable <- q7_reordered %>% 
  select(cluster_no, x7_gender, x7_age, x7_relationship, x7_education, household_size) %>% 
  group_by(cluster_no)

treemap(fish_treeable,
        index= c("cluster_no", "household_size"),
vSize="household_size",
type="index") 
```

OK, this hasn't worked out great. It works better with labels, huh. 


Let's try the same graph type we did earlier, comparing Clusters with..HH size 



Most households have 3, 4 or 5 members. Beyond that, there isn't a whole lot to gain from this comparison. 

Let's edit ages into several groups 

```{r} 
binned_age <- question_7_analysis %>%
  mutate(agegroup = case_when(               x7_age >= 60  ~ '60+',
                                             x7_age >= 50  & x7_age <= 59 ~ '40-49',
                                             x7_age >= 40  & x7_age <= 49 ~ '40-49',
                                             x7_age >= 30  & x7_age <= 39 ~ '30-39',
                                             x7_age >= 20  & x7_age <= 29 ~ '20-29',
                                             x7_age <= 20 ~ "19 and Under"))

agegroup_counts <- binned_age %>% 
  drop_na(agegroup) %>% 
  group_by(cluster_no) %>% 
  count(agegroup)


```

I broke ages of respondents into 6 groups. This may be too many to visualize alongside all 4 Clusters. 

```{r}
ggplot(agegroup_counts, 
       aes(x = cluster_no, y = n, fill = agegroup)) +
  geom_bar(position="fill", stat="identity", alpha = 0.8) +
  labs( x = "Clusters (1 and 4 are 'average')",
      y = "Fishers per Group",
      title = "What age are the Clusters?", 
      fill = "Age Group", 
      caption = "Hypothesis: Older fishers are more engaged") +
   geom_text(aes(label = n),position = position_fill(0.9), vjust = 2, size = 2, color = "gray1")+
   scale_fill_viridis(discrete = T) +
  theme_bw()
```
Ok, what do we see?! 

There were so many respondents under 20, wow! Perhaps I should be looking at 'household heads' if we really wanted this analysis of fisher ages. This is still interesting. 

Cluster 3 has a small proportion of older fishers, and a huge contingent of respondents under 20. About 50% of each cluster is 30 and under (and likewise 30 and over)


Let's do 1 more subsection of Q7. Binned HHS size? Or Relationship? I'll start with relationship. 
Filed in... *Nowhere. Exploratory section fo original analysis.*
```{r} 
relationship_counts <- question_7_analysis %>% 
  drop_na(x7_relationship) %>% 
  filter(x7_relationship != "Other") %>%
  filter(x7_relationship != "Other parent") %>%
  filter(x7_relationship != "Domestic help") %>%
  filter(x7_relationship != "Aquaintance") %>% 
  group_by(cluster_no) %>%
  count(x7_relationship)
```

```{r}
ggplot(relationship_counts,
       aes(x = cluster_no, y = n, fill = x7_relationship)) +
  geom_bar(position="fill", stat="identity", alpha = 0.8) +
  labs( x = "Clusters (1 and 4 are 'average')",
      y = "Fishers per Group",
      title = "Differences in Respondent Type", 
      fill = "Household Role of Respondent", 
      caption = "Hypothesis: Older fishers are more engaged") +
   geom_text(aes(label = n),position = position_fill(0.9), vjust = 2, size = 2, color = "gray1")+
   scale_fill_viridis(discrete = T) +
  theme_bw()
```

This is challenging because we're not likely seeing responses from the fisher of each house, rather we hear from whomever was home. If this happened to show spouses who were the fishers, vs. child fishers, etc... that would be more insightful. I'll bring this up to the group. 


##### Showing Worded responses to each Engagement/Agreement Question, for each cluster 

```{r} 
median_cluster_df <- scaled_km_df %>% 
  select(country, cluster_no, 25:35) %>% 
  group_by(country) %>% 
summarise_if(is.numeric, median) %>% 
mutate(x44_meeting_attendance = recode_factor(x44_meeting_attendance, "1" = "Yes",
                                              "-1"  = "No",
                                              "0" = "Not sure")) %>% 
  mutate(x45_leadership_position = recode_factor(x45_leadership_position, "1" = "Yes",
                                                 "-1"  = "No",
                                                 "0" = "Not sure")) %>% 
  mutate(x48_enforcement_participation = recode_factor(x48_enforcement_participation,
                                                       "1" = "Yes",
                                                       "-1"  = "No",
                                                       "0" = "Not sure")) %>%    mutate(x53_encourage_regulations = 
            recode_factor(x53_encourage_regulations,    "-2" = "Never",
                                                        "-1" = "Rarely",
                                                        "0" = "Sometimes",   
                                                        "2" = "Often",
                                                          "2" = "Very often")) %>% 
  mutate(x61g_fishing_change_behavior = 
            recode_factor(x61g_fishing_change_behavior, "1" = "Strongly disagree",
                                                        "2" = "Disagree",
                                                        "3" = "Neutral", 
                                                        "4" = "Agree",
                                                        "5" = "Strongly agree")) %>% 
  mutate(x61a_current_regulations = 
            recode_factor(x61a_current_regulations, "1" = "Strongly disagree",
                                                        "2" = "Disagree",
                                                        "3" = "Neutral", 
                                                        "4" = "Agree",
                                                        "5" = "Strongly agree")) %>% 
  mutate(x61f_rights_distribution_fair = 
            recode_factor(x61f_rights_distribution_fair, "1" = "Strongly disagree",
                                                        "2" = "Disagree",
                                                        "3" = "Neutral", 
                                                        "4" = "Agree",
                                                        "5" = "Strongly agree")) %>% 
  mutate(x43_ma_benefits = recode_factor(x43_ma_benefits, "1" = "Yes",
                                              "-1"  = "No",
                                              "0" = "Neutral/Unsure")) %>% 
  mutate(x46_represent_interests = recode_factor(x46_represent_interests, "1" = "Yes",
                                              "-1"  = "No",
                                              "0" = "Neutral/Unsure")) %>% 
  mutate(x52_ma_benefit_5yrs = recode_factor(x46_represent_interests, "1" = "Yes",
                                              "-1"  = "No",
                                              "0" = "Unsure")) 

### Separating this into Engagement and Agreement
median_engagement_df <-  median_cluster_df %>% 
  select(1:6)

median_agreement_df <- median_cluster_df %>% 
  select(1, 7:12)


median_engagement_df  %>% 
  kable(col.names = c("Country", 
                     "Meeting Attendeance", 
                     "Leadership Position", 
                     "Volunteer Enforcment",
                     "Willingness to encourage regulations",
                     "Willingness to change Behavior")) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "left"
                ) %>% 
  add_header_above(c("Median Engagement Response by County" = 6))



## Now using `kable` for the agreement table 
median_agreement_df %>% 
  
kable(col.names =  c("Country", 
                     "Benefits of Managed Access",
                     "Interests Represented",
                     "Benefit in 5 years",
                     "Regulations helping cactch",
                     "Fairness of fishing rights", 
                     "Trust in Local Leadership")) %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "left"
                ) %>% 
  add_header_above(c("Median Agreement Response by County" = 7))
```