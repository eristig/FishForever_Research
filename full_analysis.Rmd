---
title: "full_analysis"
author: "Dylan Glave"
date: "8/16/2021"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(plotly)
library(plyr)
library(tidyverse)
library(here)
library(janitor)
library(tidyverse)
library(kableExtra)
library(knitr)
library(lavaanPlot)
library(lavaan)
library(naniar)
library(here)
library(scales)
library(foreign)
library(nnet)
library(reshape2)
library(vtable)
library(stargazer)
library(viridis)
library(NbClust)
library(car)
library(corrplot)
library(RColorBrewer)
library(forcats)
library(viridis)
library(data.table)
library(treemap)

```

## R Markdown


This Rmd analyzes Rare's *Fish Forever* Household Survey (shared as HHS) from 2019, to create quantitative X-Y indices of fisher compliance behavior. As of 12/7/21, we've used K-means Cluster Analysis to see what characteristics of compliance can be grouped into fisher "types."

We often use *Engagement* and *Agreement* in this anaylisis, here are our working definitions and rationale: 

*Engagement*

*Agreement*




To start, we'll read in *all* relevant CSVs
- `hhs_all`: a single df with the **majority** of HHS questions
- `hhs` `44`, `45`, and `48`, questions that needed to be joined with the larger df

```{r, echo=FALSE}
# Read in .csv from new Rare data portal

hhs_all <- read_csv(here::here("new_portal_data", "hh_surveys_all.csv"))

# Read in separate question .csvs from the new Rare data portal
hhs_q44 <- read_csv(here::here("new_portal_data","hh_q44.csv"))
hhs_q45 <- read_csv(here::here("new_portal_data","hh_q45.csv"))
hhs_q48 <- read_csv(here::here("new_portal_data","hh_q48.csv"))
hhs_q7 <- read_csv(here::here("new_portal_data","hh_q7.csv"))


```


Next, we go through questions 44, 45, and 48 to remove any duplicates

We do this because, when reading in the original CSVs, we saw answers like, "Yes, Yes, Yes," "No, No, No, No, No" and "Yes male, yes Female, Unsure."

These questions ask respondents about their *household,* so it's possible that they answered individually for each member of their household.

However, the goal of this analysis is to see if any single member of a household participated the management meetings, or enforcement.  

To do so, we creates several df with the name `dupes...`

```{r}
# Check dupes for all questions
dupes_44 <- data.frame(table(hhs_q44$submissionid)) %>% 
  dplyr::rename(submissionid = Var1)

dupes_45 <- data.frame(table(hhs_q45$submissionid)) %>% 
  dplyr::rename(submissionid = Var1)

dupes_48 <- data.frame(table(hhs_q48$submissionid)) %>% 
  dplyr::rename(submissionid = Var1)
```

The chunks below use recode_factor() to change cells within Qs 44, 45, and 48 to each have a single answer. 

```{r}
# Cleaning data
# Question 44
hhs_q44_dupes <- hhs_q44 %>% 
  inner_join(dupes_44, hhs_q44, by = "submissionid") %>% 
  arrange(desc(submissionid)) 

# Drops rows where submissionid's with a frequency greater than 1 are labeled "Not sure"

hhs_q44_dupes <- hhs_q44_dupes[!(hhs_q44_dupes$Freq > 1 & hhs_q44_dupes$`44_meeting_attendance` == "Not sure"),]

 # Drops rows that have NA
hhs_q44_dupes <- hhs_q44_dupes[!(hhs_q44_dupes$`44_meeting_attendance` == "na"),] 

# Changes "No management to "No"
hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "No management" = "No"))

# Probably want to do this last
hhs_q44_dupes <- hhs_q44_dupes %>%
  group_by(submissionid, Freq) %>%
  summarise(`44_meeting_attendance` = paste(`44_meeting_attendance`, collapse = ' ')) %>% 
  select(-Freq)

# Checks to see if there are any dupes left
hhs_q44_dupes_2 <- data.frame(table(hhs_q44_dupes$submissionid)) %>% 
  rename(submissionid = Var1)

# Now recode the answer combos into Yes, No, & Not Sure only
hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "Yes female" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "Yes male" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "Yes male Yes female" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "Yes female Yes male" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "Yes male No" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "No Yes male" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "Yes female Yes male No" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "No Yes female" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "Yes female No" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "Yes male No Yes female" = "Yes"))

hhs_q44_dupes <- hhs_q44_dupes %>%
  mutate(`44_meeting_attendance` = recode_factor(`44_meeting_attendance`, "No No" = "No"))

```


The following chunk combines duplicated from Question 45, and renames the observations that have been repeated. 
End result: 1 observation for each submission ID


Note: After Larissa did all the cleaning below, there was an issue with the `recode()` function. Dylan replaced each of these with `recode_factor()` and all factor levels are fine. 

```{r}
# Question 45
hhs_q45_dupes <- hhs_q45 %>% 
  inner_join(dupes_45, hhs_q45, by = "submissionid") %>% 
  arrange(desc(submissionid)) 

# Drops rows where submissionid's with a frequency greater than 1 are labeled "Not sure"
hhs_q45_dupes <- hhs_q45_dupes[!(hhs_q45_dupes$Freq > 1 & hhs_q45_dupes$`45_leadership_position` == "Not sure"),]

# Drops rows that have NA
hhs_q45_dupes <- hhs_q45_dupes[!(hhs_q45_dupes$`45_leadership_position` == "na"),] 

# Changes "No management" option to "No"
hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "No management" = "No"))

# Probably want to do this last - Freq column here is artifact
hhs_q45_dupes <- hhs_q45_dupes %>%
  group_by(submissionid, Freq) %>%
  summarise(`45_leadership_position` = paste(`45_leadership_position`, collapse = ' ')) %>% 
  select(-Freq)

# Checks to see if there are any dupes left
hhs_q45_dupes_2 <- data.frame(table(hhs_q45_dupes$submissionid)) %>% 
  rename(submissionid = Var1)

# Now recode the answer combos into Yes, No, & Not Sure only
hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "Yes female" = "Yes"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "Yes male" = "Yes"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "Yes male Yes female" = "Yes"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "Yes female Yes male" = "Yes"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "Yes male No" = "Yes"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "No Yes male" = "Yes"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "No Yes female" = "Yes"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "Yes female No" = "Yes"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "Yes male Yes male" = "Yes"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "No No No" = "No"))

hhs_q45_dupes <- hhs_q45_dupes %>%
  mutate(`45_leadership_position` = recode_factor(`45_leadership_position`, "No No" = "No"))
```


Below, the same happens for question 48
```{r}

hhs_q48_dupes <- hhs_q48 %>% 
  inner_join(dupes_48, hhs_q48, by = "submissionid") %>% 
  arrange(desc(submissionid))


# Drops rows where submissionid's with a frequency greater than 1 are labeled "Not sure"
hhs_q48_dupes <- hhs_q48_dupes[!(hhs_q48_dupes$Freq > 1 & hhs_q48_dupes$`48_enforcement_participation` == "Not sure"),]


# Drops rows that have NA
hhs_q48_dupes <- hhs_q48_dupes[!(hhs_q48_dupes$`48_enforcement_participation` == "na"),] 

# Changes "No management" option to "No"
hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "No management" = "No"))


# Change "No enforcement system" and "There is no enforcement system" to "No"
hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "No enforcement system" = "No"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "There is no enforcement system" = "No"))

# Probably want to do this last - Freq column here is artifact
hhs_q48_dupes <- hhs_q48_dupes %>%
  group_by(submissionid, Freq) %>%
  summarise(`48_enforcement_participation` = paste(`48_enforcement_participation`, collapse = ' ')) %>% 
  select(-Freq)

# Checks to see if there are any dupes left
hhs_q48_dupes_2 <- data.frame(table(hhs_q48_dupes$submissionid)) #%>% 
  #rename(submissionid = Var1)

# Now recode the answer combos into Yes, No, & Not Sure only
hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "Yes female" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "Yes male" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "Yes male Yes female" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "Yes female Yes male" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "Yes male No" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "No Yes male" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "No Yes female" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "Yes female No" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "No No No" = "No"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "No No" = "No"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "Yes male No No" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "No No Yes male" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "Yes female Yes female Yes female" = "Yes"))

hhs_q48_dupes <- hhs_q48_dupes %>%
  mutate(`48_enforcement_participation` = recode_factor(`48_enforcement_participation`, "Yes female Yes male No" = "Yes"))
```

I'm quite interested in question, which is its own CSV. What does that mean? It means I ahve to do the same duplicate process ass q 44, 45, and 48. 


```{r}


dupes_7 <- data.frame(table(hhs_q7$submissionid)) %>% 
  dplyr::rename(submissionid = Var1)



hhs_q7_dupes <- hhs_q7 %>% 
  inner_join(dupes_7, hhs_q7, by = "submissionid") %>% 
  arrange(desc(submissionid))

# hhs_q7_dupes <- hhs_q7_dupes %>%
#   group_by(submissionid, Freq) %>%
#   summarise(`7_gender` = paste(`7_gender`, collapse = ' ',
#                                `7_age` = paste(`7_age`, collapse = ' ')))


q7_df <- hhs_q7_dupes %>% 
  group_by(submissionid) %>%
   summarise_all(list(~ .[!is.na(.)][1])) %>% 
  rename(household_size = Freq)


# hhs_q7_dupes <- hhs_q7_dupes[!(hhs_q7_dupes$Freq > 1),]


```





Again, `recode()` has been switched to `recode_factor()` for question 48

After recoding/cleaning, these different df were all combined into `hhs_complete_all` using `right_join`

```{r}
# Join the datasets after all the cleaning is done
hhs_all_48 <- right_join(hhs_q48_dupes, hhs_all, by = "submissionid")

hhs_all_45 <- right_join(hhs_q45_dupes, hhs_all_48, by = "submissionid")

hhs_all_7 <- right_join( hhs_all_45, q7_df, by = "submissionid")

hhs_all_complete <- right_join(hhs_q44_dupes, hhs_all_7, by = "submissionid")

write.csv(hhs_all_complete, file = "hhs_all_complete.csv")

# No need to run the above code again, I have already written a .csv with the joined datasets

hhs_all_complete <- read_csv("hhs_all_complete.csv")
```


On 12/15/21, we reloaded the `"hhs_all"` CSV file, which now includes question 4, which was missing. 
*"Does your community have the following?
1. Marine Reserve/No-Take Area
2. Fisheries Management Area (MPA, Managed Access Area, etc.) 3. Fisheries Management Body"*

Possible answers include: 

2] "marine reserve"                                   
 [3] "management area,marine reserve,management body"   
 [4] "marine reserve,management area,management body"   
 [5] "management body,management area,marine reserve"   
 [6] "management area"                                  
 [7] "management area,management body"                  
 [8] "marine reserve,management area"                   
 [9] "management area,management body,marine reserve"   
[10] "management body"                                  
[11] "na"                                               
[12] "marine reserve,management body"                   
[13] "marine reserve,management body,management area"   
[14] "management area,marine reserve"                   
[15] "management body,marine reserve"                   
[16] "management body,marine reserve,management area"   
[17] "management body,management area"                  
[18] "na,marine reserve"                                
[19] "na,marine reserve,management area"                
[20] "na,management area"                               
[21] "marine reserve,na"                                
[22] "na,marine reserve,management area,management body"
[23] "management area,na"                               
[24] "none"                                             
[25] "marine reserve,management body,na"                
[26] "marine reserve,none"        

Let's..rename some of these. 


```{r}


hhs_all_complete_4_test <- hhs_all_complete %>% 
  mutate(`4_ma_r_mb` = recode_factor(`4_ma_r_mb`,
               "marine reserve" = "Reserve",             # [2]                    
              "management area,marine reserve,management body" = "All 3", #[3]
              "marine reserve,management area,management body" = "All 3", # [4]
              "management body,management area,marine reserve" = "All 3", # [5],
              "management area" = "MA",                                   # [6]
              "management area,management body"       =     "MA and FMB", # [7],
              "marine reserve,management area"      = "MA and Reserve",   # [8]
              "management area,management body,marine reserve" = "All 3", # [9]
              "management body"  = "MA",                                 # [10]
              "na" = "none",                                             # [11]
              "marine reserve,management body" = "MA and FMB",           # [12]
              "marine reserve,management body,management area" = "All 3", # [13]
              "management area,marine reserve" =  "MA and Reserve",      # [14]
              "management body,marine reserve" =  "MA and FMB",           # [15]
              "management body,marine reserve,management area"  = "All 3", # [16]
              "management body,management area" = "MA and FMB",           # [17]
              "na,marine reserve" = "Reserve",                            # [18]  
              "na,marine reserve,management area" = "MA and Reserve",     # [19]
              "na,management area" = "MA",                                # [20]
              "marine reserve,na" = "MA",                                # [21]
              "na,marine reserve,management area,management body" = "All 3", # [22]
              "management area,na" =  "MA",                             # [23]
              "marine reserve,management body,na" = "MA and Reserve",    # [25]
              "marine reserve,none" = "MA"))

counts_x4 <- 
  hhs_all_complete_4_test %>% 
  count(`4_ma_r_mb`)
         
```




Here is a quick summary table of the total number of responses, which matches the **original** number of surveys completed
17712
```{r}

# Get list of all reserves by country & how many HH surveys were answered
summary <- hhs_all_complete %>% 
  count(country, level1_name, level2_name, ma_name) %>% 
  #arrange(-n) %>% 
  mutate(level1_name = fct_reorder(country, n, sum)) %>% 
  adorn_totals("row")

# Summary table contains two NA's in the 'ma_name' column
# 75 reserves if you look at uniques
```

##### Filtering Cleaned Data


Alright! 

This marks the end of the "cleaning" data section. The final two dataframes 
(hhs_all_complete and summary) have each survey response as 1 row, with no duplicates, and questions that were answered multiple times (44, 45, and 48) now have 1 answer of *Yes, No,* or *Unsure*. 



##### Filtering out NAs:

*Goal: A robust df with only observations (survey respondents) who have answered every engagement and agreement question.*

Engagement includes questions 44, 45, 48, 53, 61g.  
Agreement includes questions 43, 46, 52, 61a, 61f.  
NOTE TO DYL - ADD SOMETHING ABOUT THESE VARIABLES

This will be called **`hhs_complete_filtered`**

First, let me get counts of the NAs that we are changing to neutral for Q 44 and 45. We think these two will filter out a large amount of observations:


```{r}
counts_44_45 <- hhs_all_complete %>% 
  data.frame() %>% 
  clean_names() %>% 
  count(x44_meeting_attendance, x45_leadership_position) 

counts_43 <- hhs_all_complete %>% 
  data.frame() %>% 
  clean_names() %>% 
  count(x43_ma_benefits) 
```
This filters out 1000s of observations, which we accept. We want to observe responses from fishers who took part in all the relevant survey questions. 


Here,  I created our filtered df, where each observation responds to every *agreement* and *engagement* question. These questions exist in rows 24:33, therefore `drop_na` is used for those columns.    
```{r}

 hhs_complete_filtered <- hhs_all_complete %>% 
  data.frame() %>% 
  clean_names() %>% 
 select( c(1:2, 6:26, x44_meeting_attendance, x45_leadership_position,
x48_enforcement_participation,  x53_encourage_regulations,
 x61g_fishing_change_behavior, 
            x43_ma_benefits, x46_represent_interests,  x52_ma_benefit_5yrs, x53_encourage_regulations, x61a_current_regulations, x61f_rights_distribution_fair,
x30_trust_local_decision, 
x67_reserve_boundry,
x11a_income_farming, x11a_months_farming, x11b_income_harvesting, x11b_months_harvesting, x11c_income_fishing_artisanal,  x11c_months_fishing_artisanal, x11d_income_fishing_industrial,
x11d_months_fishing_industrial, x11e_income_buying_trading, x11e_months_buying_trading, x11f_income_processing, x11f_months_processing, x11g_income_aquaculture, x11g_months_aquaculture, x11h_income_extraction,
x11h_months_extraction, x11i_income_tourism, x11i_months_tourism,   x11j_income_other_wage, x11j_months_other_wage, x11k_income_other,
x11k_months_other, x11k_other_source, 
x12a_fishing_men, x12b_fishing_women, x12c_fishing_children, 
x19_current_fish_catch, 
x22_catch_5yrs, x17_fishing_low_profit, x18_fishing_high_profit,          
x23_job_secure, x26_fishing_income_save, x28_buyer_loans, x29_family_income,
x30_trust_community,x30_trust_community_neighbors, x30_trust_fishers_community,
x30_trust_fishers_other, 
x30_trust_ngo, x30_trust_regional_decision, x30_trust_religious_leaders,
x30_trust_village_alert, x31_my_community_ability,
x38_reserve_fishing_allowed, 
x39_ma_boundaries_aware, 
x40_reserve_boundaries_aware,
x49_enforcement_responsible,
x50_ma_punishment,
x51a_fishers_gear_not_permitted, x51b_fishers_reserves, 
x51c_fishers_ma_area, x51d_fishers_violate_fish_size, x51e_fishers_caught,
x55_worry_food, x55_worry_food,
x56_reduce_meal_size_adult,  x59_food_procurement,
x60_hh_fish_consumption,
x61b_catch_recording, x61c_community_participation, x61d_strong_enforcement, 
x61h_individual_behavior,
x61i_help_neighbors,
x66_reaction_fishing_reserve, x66_response_fishing_reserve, x62_reserve_compliance, x63_fishing_in_reserve, x64_wrong_fishing_reserve, x21_boat_owner_status,
x32_fishery_benefit_equal,
x51b_fishers_reserves,
x70_hh_average_income, 
x7_gender, x7_age, x7_relationship, x7_gender, x7_education, household_size,
)) %>% 
 # mutate_at(c(24:25), ~replace(., is.na(.), 0)) %>% 
   drop_na(24:34) %>% 
    filter(x53_encourage_regulations != "No regulations")  %>% 
    filter(x46_represent_interests != "No management") %>% 
    filter(x52_ma_benefit_5yrs != "No management") %>% 
  filter(x30_trust_local_decision != "6")


```


Update on *Agreement* From 9/9/2021: 
In analysis with Dr. Quintana, after looking at variable independence and reframing of what Agreement includes, we are removing the following three questions from the Index: 
- Question 10 (x10_mpa_important) due to wording that doesn't focus on MPAs
- Question 47 (x47_represent_contributions) due to its near exact math to question 46. This would give these two similar questions as much weight as the other agreement components, which we don't want. 
- Question 62 (x62_reserve_compliance) because this question outright asks if fishers follow the rules. This does not have to do with their Agreement
- Question 64 (x64_wrong_fishing_reserve) was not asked in Brazil, and we want to include these 756 observations, as the country is a lage focus of the Fish Forever process.

You won't see this method step in the code, as we'e removed it, but it is worth noting that our indices evolved as we scrutinzed the definitions fo Engagement and Agreement. 

Now  columns [24:33] within `hhs_complete_filtered` are all of the Engagement and Agreement questions. There are exactly 5 questions for each index. 



- *Dropping NAs*: We drop NAs for all Engagement and Agreement Questions. 


- *For Q 46-47* we've excluded NAs since they mostly represent "non-fisher households" The difference in n goes from 5640 to ~4500. We want to see how *fishers* comply though. So the smaller N will show us that. 



*12/27/21*

We're adding 1 question to the Agreement index, either `x30_trust_local_decision` or `30_trust_regional_decision`

I'll run a `corplot` how the two questions compare

```{r}
x30_compared <- 
  hhs_complete_filtered %>% 
  select(x30_trust_local_decision, x30_trust_regional_decision) %>% 
  drop_na()

corrplot(cor(x30_compared))

```

alright, they're highly correlated, we're going to stick with "local decision-makers"

#### Quantitiative values of survey Answers

Let me list out which A and E questions have binary responses, for those that have "neither agree nor disagree," then I'll move from -1 to 1, with a neutral option 0. From here, I change all 10 index-components (thr 10 questions) into numeric variables. 


###### Agreement 

I'll start converting the straightforward questions to 1s and 0s. 
**Because there was so much much dang coding in the global_filtered, I'll make a new df for the numbered version. 
We'll call it **hhs_filtered_numeric**


###### Engagement

NOTE TO DYL, INCLUDE 2-3 WORD IDNICATOR PER QUESTION BELOW
Quantification list:

- 44: Yes/No 1/-1 (We recoded not sure to 0, see Methods)
- 45: Yes/No 1/-1 (We recoded 'Not sure to 0, see Methods)
- 48: Yes/No/Not Sure (1,0,-1) 
- 53: Never - Very Often  (1-5)
- 61 (f): Likert Scale (Strongly) Disagree-Agree (1-5) 
- 61 (h): Likert Scale (Strongly) Agree-Disagree (1-5)

###### Agreement

- 43: Yes/No: (1,0,-1)
- 46: Agree/Neither/Disagree: (1,0,-1)
- 52: Yes/Unsure-No management-na/No: (1,0,-1)
- 61(a): Likert Scale (Strongly) Agree-Disagree 1-5
- 61(e): Likert Scale (Strongly) Agree-Disagree 1-5 


The chunk below uses `mutate()` and `recode_factor` to complete the numeration above. 
```{r}
hhs_filtered_numeric <- hhs_complete_filtered %>% 
 mutate(x44_meeting_attendance = recode_factor(x44_meeting_attendance, "Yes" = "1", "No"  = "-1", "Not sure" = "0")) %>% 
  mutate(x45_leadership_position = recode_factor(x45_leadership_position, "Yes" = 1, "No"  = -1, "Not sure" = 0, "0" = 0)) %>% 
  mutate(x48_enforcement_participation = recode_factor(x48_enforcement_participation, "Yes" = 1, "No"  = -1, "Not sure" = 0, "0" = 0))  %>% 
   mutate(x53_encourage_regulations = recode_factor(x53_encourage_regulations,    "Never" = -2, "Rarely" = -1, "Sometimes" = 0,   
"Often" = 1, "Very often" = 2)) %>%
# mutate(x67_reserve_boundry = recode_factor(x67_reserve_boundry, 
#                                           "1" = "1",
#                                           "0" = "-1",
#                                            "-1" = "0")) %>% 
## 61 e and h are already coded for likert scale 
  
  
## Agreement recoding below: 
  
mutate(x46_represent_interests = recode_factor(x46_represent_interests,    "Agree" = 1, "Disagree" = -1, "Neither" = 0,  
  "na" = 0)) %>% 
 mutate(x52_ma_benefit_5yrs = recode_factor(x52_ma_benefit_5yrs, "Yes" = 1, "No"  = -1, "Unsure" = 0, "na" = 0)) %>% 
  mutate(x62_reserve_compliance = recode_factor(x62_reserve_compliance,
    "go up" = 1, "3. La captura de los pescadores aumentará" = 1,
        "stay same" = 0, "2. La captura de los pescadores seguirá igual"  = 0,       "not know"  = 0, "4. No sabe" = 0, 
         "go down" = -1, "La captura de los pescadores disminuirá" = -1)) %>% 
  mutate(x64_wrong_fishing_reserve = recode_factor(x64_wrong_fishing_reserve,
     "extremely wrong" = 5, "5. Extremadamente malo" = 5,
     "very wrong" = 4, "4. Muy malo" = 4,
       "moderately" = 3, "3. Moderadamente malo" = 3,        
 "Un poquito malo" = 2,   "slightly" = 2,                           
           "1. Nada malo" = 1,  "not at all" = 1, "na" = 0)) %>%   
   mutate(x4_ma_r_mb = recode_factor(x4_ma_r_mb,
               "marine reserve" = "Reserve",             # [2]                    
              "management area,marine reserve,management body" = "All 3", #[3]
              "marine reserve,management area,management body" = "All 3", # [4]
              "management body,management area,marine reserve" = "All 3", # [5],
              "management area" = "MA",                                   # [6]
              "management area,management body"       =     "MA and FMB", # [7],
              "marine reserve,management area"      = "MA and Reserve",   # [8]
              "management area,management body,marine reserve" = "All 3", # [9]
              "management body"  = "MA",                                 # [10]
              "na" = "none",                                             # [11]
              "marine reserve,management body" = "MA and FMB",           # [12]
              "marine reserve,management body,management area" = "All 3", # [13]
              "management area,marine reserve" =  "MA and Reserve",      # [14]
              "management body,marine reserve" =  "MA and FMB",           # [15]
              "management body,marine reserve,management area"  = "All 3", # [16]
              "management body,management area" = "MA and FMB",           # [17]
              "na,marine reserve" = "Reserve",                            # [18]  
              "na,marine reserve,management area" = "MA and Reserve",     # [19]
              "na,management area" = "MA",                                # [20]
              "marine reserve,na" = "MA",                                # [21]
              "na,marine reserve,management area,management body" = "All 3", # [22]
              "management area,na" =  "MA",                             # [23]
              "marine reserve,management body,na" = "MA and Reserve",    # [25]
              "marine reserve,none" = "MA")) %>% 
  filter_at(vars(x61a_current_regulations, x61f_rights_distribution_fair, x61g_fishing_change_behavior), all_vars((.) != 0)) %>% 
    mutate_at(vars(24:33), ~as.numeric(as.character(.))) %>% 
  add_row( x1  = NA,  
           submissionid    = NA,   
           country    = "NEUTRAL",
level1_name  = NA,     
level2_name   = NA,
level4_name     = NA, 
level4_id         = NA, 
lat = NA,
lon = NA,                   
ma_name  = NA,     
ma_area  = NA,
ma_status  = NA,
username = NA,
x1_interviewer = NA, 
 x2_affiliation  = NA,  
x3_community  = NA, 
x4_ma_r_mb = NA,
x5_hh_status = NA,
 x6_gender   = NA,     
x8_religion  = NA,         
x8_religion_other    = NA,
  x9_region_member   = NA,   
x9_region_name    = NA,
x44_meeting_attendance   = 0,
 x45_leadership_position   = 0,
x48_enforcement_participation = 0,
x53_encourage_regulations= 0,
 x61g_fishing_change_behavior  = 3,
x67_reserve_boundry = 0,
x43_ma_benefits     = 0,
x46_represent_interests =  0,
  x52_ma_benefit_5yrs  = 0,
x61a_current_regulations   = 3,
x61f_rights_distribution_fair = 3,
x30_trust_local_decision = 3,
  x11a_income_farming    = NA,
x11a_months_farming    = NA,
x11b_income_harvesting   = NA,
  x11b_months_harvesting       = NA,
x11c_income_fishing_artisanal   = NA,
x11c_months_fishing_artisanal  = NA,
  x11d_income_fishing_industrial = NA,
x11d_months_fishing_industrial = NA,
x11e_income_buying_trading     = NA,
  x11e_months_buying_trading   = NA,
x11f_income_processing      = NA,
x11f_months_processing     = NA,
  x11g_income_aquaculture    = NA,
x11g_months_aquaculture    = NA,
x11h_income_extraction      = NA,
  x11h_months_extraction    = NA,
x11i_income_tourism   = NA,
x11i_months_tourism    = NA,
  x11j_income_other_wage     = NA,
x11j_months_other_wage    = NA,
x11k_income_other      = NA,
  x11k_months_other  = NA,
x11k_other_source = NA,
x12a_fishing_men   = NA,
  x12b_fishing_women  = NA,
x12c_fishing_children  = NA,
  x19_current_fish_catch   = NA,
  x22_catch_5yrs    = NA,
x23_job_secure    = NA,
x26_fishing_income_save  = NA,
  x28_buyer_loans    = NA,
x29_family_income    = NA,
x30_trust_community   = NA,
  x30_trust_community_neighbors = NA,
  x30_trust_fishers_community = NA,
x30_trust_fishers_other   = NA,
x30_trust_ngo     = NA,
x30_trust_regional_decision  = NA,
  x30_trust_religious_leaders  = NA,
  x30_trust_village_alert   = NA,
  x31_my_community_ability  = NA,
  x38_reserve_fishing_allowed  = NA,  
x39_ma_boundaries_aware   = NA,      
x40_reserve_boundaries_aware   = NA,
  x49_enforcement_responsible   = NA,
x50_ma_punishment      = NA,  
x51a_fishers_gear_not_permitted = NA,
  x51b_fishers_reserves       = NA,   
x51c_fishers_ma_area   = NA,
x51d_fishers_violate_fish_size = NA,
  x51e_fishers_caught      = NA,
x55_worry_food      = NA, 
x56_reduce_meal_size_adult     = NA,
  x59_food_procurement       = NA,
x60_hh_fish_consumption        = NA,
x61b_catch_recording     = NA,
  x61c_community_participation   = NA,
x61d_strong_enforcement   = NA, 
x61h_individual_behavior       = NA,
  x61i_help_neighbors      = NA,
x66_reaction_fishing_reserve   = NA,
x66_response_fishing_reserve  = NA,
  x62_reserve_compliance  = NA, 
x63_fishing_in_reserve    = NA, 
x64_wrong_fishing_reserve      = NA,
 x21_boat_owner_status = NA, 
x32_fishery_benefit_equal = NA,
x70_hh_average_income = NA)

```

** I added a NEUTRAL ** observation with `add_row` to map out where the true neutral fisher is on our typology. This helps up see the distribution of scaled responses around the "neutral" fisher who answered the middle response to every question. 


Notes: 
- For the Likert scale questions that Rare coded from 0-5, I removed the 0s, since they were equivalent to NAs. 

- All "No management" or "No regulations" ar gone. and all 0s have been removed from questions that rare coded from 0-5. Only 1 question made a significant change, `x61f_rights_distribution_fair`


Now, I **believe** it's time to scale the data! 


Let's just make a quick table with the *counts* of all the survey responses that we have for analysis. 

```{r}
# hhs_filtered_count <- hhs_filtered_numeric %>% 
#   count(ma_name) %>% 
#   arrange(-n) %>% 
#   #mutate(level1_name = fct_reorder(level1_name, n, sum)) %>% 
#   adorn_totals("row") %>% 
#   rename("Managed Access Area" = ma_name) %>% 
#   rename("Number of surveys with all 'Agreement' and 'Engagement' questions answered" = n)
# 
# 
# count_table <- knitr::kable(hhs_filtered_count, format = "html", caption = "Engagement and Agreement Summary") %>% 
#   #column_spec(1, italic = TRUE) %>% 
#  # row_spec(dim(hhs_filtered_count)[1], bold = TRUE) %>%
#   kable_styling(c("condensed", "responsive", "bordered"), full_width = F, position = "right") %>% 
#   collapse_rows(columns = 1, valign = "middle")
# 
# count_table

```


Counts by Reserve is great, but Larissa would like the same table by *Country*

```{r}

hhs_count_by_country <- hhs_filtered_numeric %>% 
  count(country) %>% 
  arrange(-n) %>% 
  #mutate(level1_name = fct_reorder(level1_name, n, sum)) %>% 
  adorn_totals("row") %>% 
  rename("Country" = country) %>% 
  rename("Number of surveys with all 'Agreement' and 'Engagement' questions answered" = n)

summary_2 <- hhs_complete_filtered %>% 
     count(country, level1_name, level2_name, ma_name) %>% 
     #arrange(-n) %>% 
     mutate(level1_name = fct_reorder(country, n, sum)) %>% 
     adorn_totals("row")

country_count_table <- knitr::kable(hhs_count_by_country, format = "html", caption = "Engagement and Agreement Country Summary") %>% 
  #column_spec(1, italic = TRUE) %>% 
  row_spec(dim(hhs_count_by_country)[1], bold = TRUE) %>%
  kable_styling(c("condensed", "responsive", "bordered"), full_width = F, position = "right") %>% 
  collapse_rows(columns = 1, valign = "middle")

country_count_table

```
\*Table 1: Survey Responses by Managed-Access Area*

Note that "Managed-Access Area" is a  spatial measurement that Rare uses for its own management, fishers (nor government) think fot hem as community or fishery boundaries, to the best of our knowledge. 


###### Scaling
We want *relative* index scores for each fisher. To do so, we take the Z-score of each observation, for each index-component. From there, we take the mean of the 5 questions to give each response 2 Index scores: 1 for Agreement and 1 for Engagement. 


I've run `unique()` for all the E & A questions, ensuring that we only have responses that are measurable. 

Following this with a check of the "no management" answers, and how they were coded. 


With the statistics, we see the new mean, sd, etc. for all the agreement and engagement question. 
```{r}


hhs_scaled <- 
  hhs_filtered_numeric %>% 
  mutate_at(vars(24:33), ~as.numeric(as.character(.))) %>% 
  
  mutate(x44_scaled = as.numeric((x44_meeting_attendance - mean(x44_meeting_attendance))/sd(x44_meeting_attendance))) %>% 

  
  mutate(x45_scaled = (x45_leadership_position - mean(x45_leadership_position))/sd(x45_leadership_position)) %>% 
  
  mutate(x48_scaled = (x48_enforcement_participation - mean(x48_enforcement_participation))/sd(x48_enforcement_participation)) %>% 
  
  mutate(x53_scaled = (x53_encourage_regulations - mean(x53_encourage_regulations))/sd(x53_encourage_regulations)) %>% 
  
  mutate(x61g_scaled = (x61g_fishing_change_behavior - mean(x61g_fishing_change_behavior))/sd(x61g_fishing_change_behavior)) %>% 
  # mutate(x67_scaled = (x67_reserve_boundry - mean(x67_reserve_boundry))/sd(x67_reserve_boundry)) %>% 

  ##Switch from Engagement to Agreement

 # mutate(x10_scaled = (x10_mpa_important - mean(x10_mpa_important))/ sd(x10_mpa_important)) %>% 
  ## We removed question 10 from the indez
  mutate(x43_scaled = (x43_ma_benefits - mean(x43_ma_benefits))/sd(x43_ma_benefits)) %>% 
  mutate(x46_scaled = (x46_represent_interests - mean(x46_represent_interests))/sd(x46_represent_interests)) %>% 
#  mutate(x47_scaled = (x47_represent_contributions - mean(x47_represent_contributions))/sd(x47_represent_contributions)) %>% 
  # 47 was also removed from the index
  mutate(x52_scaled = (x52_ma_benefit_5yrs - mean(x52_ma_benefit_5yrs))/sd(x52_ma_benefit_5yrs)) %>% 
  mutate(x61a_scaled = (x61a_current_regulations - mean(x61a_current_regulations))/sd(x61a_current_regulations)) %>% 
   mutate(x61f_scaled = (x61f_rights_distribution_fair - mean(x61f_rights_distribution_fair))/sd(x61f_rights_distribution_fair)) %>% 
  mutate(x30a_scaled = (x30_trust_local_decision - mean(x30_trust_local_decision))/sd(x30_trust_local_decision))
  



  
```

I've double-checked the statistics on each of the above variables! Each new column has a mean of nearly 0 (3x10^-16, etc.) This gives me confidence that all the math is correct. 

Since we changed `recode()` to `recode_factor()`, these stats functions would not run. By changing the values to as.numeric, all is well. 


###### Index Scores

*Let's start with  `mean()` and `sum()`* 

Along with scaling the data onto a Z-Axis, I'm going to simply sum across the agreement and engagement columns too, to see what we get. 
- `eng_mean` is the mean index score of *engagement,* with 1 score for each fisher respondent
- `agree_mean` is the mean score of *agreement* for each fisher respondent 
- I add two more variables:  `eng_sum` and `agree_sum` 
Without scaling, I've summed agreement and engagement across rows, for exploratory visualization
```{r}




scaled_sum <- hhs_scaled %>% 
 rowwise() %>% 
  mutate(eng_sum = sum(x44_scaled, x45_scaled, x48_scaled, x53_scaled,  x61g_scaled))  %>% 
  mutate(agree_sum = sum (x43_scaled, x46_scaled, x52_scaled, x61a_scaled, x61f_scaled, x30a_scaled))  %>% 
  mutate(eng_mean = mean(c(x44_scaled, x45_scaled, x48_scaled,  x53_scaled,  x61g_scaled))) %>% 
  mutate(agree_mean = mean(c(x43_scaled, x46_scaled, x52_scaled,  x61a_scaled,  x61f_scaled, x30a_scaled))) %>% 
  rowwise() %>%
  mutate(raw_agree_mean = mean(c(x43_ma_benefits, x46_represent_interests, x52_ma_benefit_5yrs, x61a_current_regulations, x61f_rights_distribution_fair, x30_trust_local_decision))) %>% 
   mutate(raw_eng_mean = mean(c(x44_meeting_attendance, x45_leadership_position, x48_enforcement_participation, x53_encourage_regulations, x61g_fishing_change_behavior)))




    ## Below I add two more variables:  "raw_eng_sum" and "raw_agree_sum." Without scaling, I've summed agreement and engagement across rows, for exploratory visualization
 # mutate(raw_eng_sum = sum(c(x44_meeting_attendance, x45_leadership_position, x48_enforcement_participation, x53_encourage_regulations, x61g_fishing_change_behavior))) %>% 
#  mutate(raw_agree_sum = sum(c(x43_ma_benefits, x46_represent_interests, x52_ma_benefit_5yrs, x61a_current_regulations, x61f_rights_distribution_fair, x64_wrong_fishing_reserve)))

```



`scaled_sum` is the main df used for A/E visualization and analysis. It includes the `agree_mean` and `eng_mean` index variables, as well as dozens of other survey variables that we look at in relation to our indices. 


**Since I've done a lot of analysis that takes away from the streamlined narrative here, I'm going to `write.csv` for scaled_sum, and add those (like graphs of each individual question) visualizations, etc. into another .Rmd**


```{r}

write.csv(scaled_sum, "scaled_sum.csv", row.names = FALSE)
```
`side_analysis.Rmd` contains the following analyses and visualizations: 

- Bar Graphs for each A & E Question (to see the spread of responses, by question)
- Cluster analysis for *seperately* Agreement and Engagement
- UNSCALED K-Means Clustering (Was in use, up until 11/17/21)
- A large amount of visualizations for the unscaled Cluster analysis above


...**Back to regular-scheduled programming**

**Creating a df of the "neutral" fisher, who I added to the original hhs df**

```{r}
neutral_point <- scaled_sum %>% 
filter(country == "NEUTRAL")
  
```


**Per Steve and Chris' feedback, I am going to manually relevel the indices to a substantive (non-relative) scale, as shown below**

- Questions with *-1, 0, 1* will remain the same
- Questions on a *1-5* or *-2-2* scale will transform into a *-1, -0.5, 0, 0.5, 1* scale, and from there we will take the means. 

The following attempt to create a scaled (without Z-scores, is on hold as of 12/6/21. Contact D Glave to edit/advance)
```{r}
raw_index_leveling <- scaled_sum %>%
  select(country, x43_ma_benefits, x46_represent_interests, x52_ma_benefit_5yrs, x61a_current_regulations, x61f_rights_distribution_fair,x44_meeting_attendance, x45_leadership_position, x48_enforcement_participation, x53_encourage_regulations, x61g_fishing_change_behavior) %>%
mutate(x61f_rights_distribution_fair= (x61f_rights_distribution_fair-3)/2) %>% 
  mutate(x61a_current_regulations= (x61a_current_regulations-3)/2) %>% 
  mutate(x53_encourage_regulations= x53_encourage_regulations/2) %>% 
  mutate(x61g_fishing_change_behavior = (x61g_fishing_change_behavior-3)/2) %>% 
  mutate(eng_mean = mean(x44_meeting_attendance + x45_leadership_position + x48_enforcement_participation + x53_encourage_regulations + x61g_fishing_change_behavior)) %>% 
mutate(agree_mean = mean(x43_ma_benefits + x46_represent_interests + x52_ma_benefit_5yrs + x61a_current_regulations + x61f_rights_distribution_fair))
  

  
```

**NOTE: `raw_index_leveling` is a bit funky. We leveled each 1-5 response into [-1, -0.5, 0, 0.5, 1]**

We want to see a non-relative index measure, which leaves us with much less variation in possible outcomes (potential locations on an X-Y map.)
This tricky step happens because we don't want a step from "4" to "5" in likert to be the same as a step from "Neutral" to "Yes" on a binary question. But we sort of have to. 


Let's visualize this version


```{r}

ggplot(data = raw_index_leveling,
                      aes(x = agree_mean, y = eng_mean)) +
   # geom_point(color = "darkblue", size = 0.7, alpha = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engagement and Agreement Index Mapping") +
 geom_bin2d(bins = 50) +
   scale_color_viridis(discrete = TRUE, option = "D") +
   # scale_x_continuous(limits = c(-2.5, 1.7),
   #                   breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  theme_bw()

```



```{r}
# index_table_df <- scaled_sum %>% 
#   select(country, eng_mean, agree_mean) %>% 
#   rename("Relative Engagement Score" = eng_mean) %>% 
#   rename("Relative Agreement Score" = agree_mean)
# 
# 
# index_table_k <- head(index_table_df) %>% 
#   kable( format = "html", caption = "Engagement and Agreement Index Scores") %>% 
#   kable_styling(bootstrap_options = "striped", 
#                 full_width = F,
#                 position = "left") %>% 
# collapse_rows(columns = 3, valign = "middle")
# 
# index_table_k

```

#### Mapping Indices

We now have one (x,y) point for each fisher observation, and can map them onto an X-Y plane of Agreement and Engagement. 


```{r}
 ggplot(data = scaled_sum,
                      aes(x = agree_mean, y = eng_mean)) +
   geom_point(color = "darkblue", size = 0.7, alpha = 0.7) +
  geom_point(data = neutral_point, aes(x = agree_mean, y = eng_mean),
             size = 8, color = "pink2") +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engagement and Agreement Index Mapping") +
#  scale_color_viridis(discrete = TRUE, option = "D") +
    # scale_x_continuous(limits = c(-3, 1.7),
    #                   breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  theme_bw()

```
*Figure 1: A plot with the **neutral* fisher reported within the of our Z-score-based indices. We see that Ms. Neutral is 1 SD below the mean in agreement. This location means that the majority of fishers at least somewhat agree with rules in place. Meanwhile, we see dense grouping between -0.5 and 0.5 on both axes. Quite a few fishers have the maximum score for agreement, while a smaller number meet the *ceiling* of engagement. 


I hypothesize that (with Rare's perspective) that changing *engagement* of fishers in the opportunity; improving agreement is important, but we see more measurable room for change on the engagement axis.* 

Let's figure out the *counts* for those two ceiling locations. 


```{r}
agree_ceiling_counts <- scaled_sum %>% 
  group_by(agree_mean) %>% 
  count() %>% 
  arrange(!n)
```
The lowest score is -2.94 , N=1
Max score = 1.07, N = 124
As shown visually, many fishers agree with rules fully, far fewer engage as fully as possible. 


```{r}
eng_ceiling_counts <- scaled_sum %>% 
  group_by(eng_mean) %>% 
  count() %>% 
  arrange(!n)


ceiling_counts <- scaled_sum %>% 
  mutate(across(where(is.numeric), ~ round(., 2))) %>% 
  group_by(eng_mean, agree_mean) %>% 
  count() %>% 
  arrange(n)

```
*Engagement*
Max value = 1.6, N=25

Lowest value = -1.74, N=1 

```{r}
ggplot(data = scaled_sum,
                      aes(x = agree_mean, y = eng_mean)) +
   geom_bin2d(bins = 20) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engagement and Agreement Index Mapping") +
#  scale_color_viridis(discrete = TRUE, option = "D") +
   scale_x_continuous(limits = c(-2.5, 1.7),
                     breaks = c(-2, -1, -0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.5)) +
   scale_y_continuous(limits = c(-1.5, 1.5),
                     breaks = c( -1, 0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.5)) +
  # guides(colour = guide_legend(override.aes = list(size=7))) +
  scale_fill_continuous(type = "viridis") +
  theme_bw()

```
*Figure 2: Density plot of the ~3200  responses. This allows us to see where points overlap, which was challenging in the first figure. We see a wide density field between -0.5 and 0.5 on the agreement axis, and -0.5 and 0.25 on the engagement axis; The densest group lies just below ) on both axes. We also find a dense bundle of fishery "leaders" right at (0,1.)  

Some of the modes:

1. (-0.15, 0.98) N=63
2. (=0.06, -0.46) N=59
3. (0.27, -0.23) N=52
4. (0.47, -0.65) N = 36




What do we think of these??

```{r}
 ggplot(data = scaled_sum,
       aes(x = agree_sum, y = eng_sum, color = country)) +
 geom_point(size = 0.7, alpha = 0.7) +
  theme_bw()
```
*Figure 3:When we look at countries, Honduras accounts for the majority of outliers (very low agreement.) Generally we see that each country includes a spread of fishers across the map of compliance attitudes; The Philippines has the most responses by a large margin. 


### Remaking indices without relative scales 

First, I'll use `raw_eng_mean` and `raw_agree_mean` to see the spread of fisher attitudes



- The "neutral point" is **(0.6, 6)**

I now want to see the stats of the raw means, vs. the scaled means. 
First, I make a sf called `four_means` that includes: `raw_agree_mean` `raw_eng_mean` `agree_mean` and `eng_mean`
```{r}

four_means <- scaled_sum %>% 
  select(raw_agree_mean, raw_eng_mean, agree_mean, eng_mean)


st(four_means)
```
*Raw Agreement*
Mean = 2.21
sd = .40
Range: 0.7-3
pct. 25 = 2
pct. 75 = 3

*Raw Engagement*
Mean = 0.6 (same as the neutral point)
sd = 0.52
Range: -0.8 - 2
pct. 25 = 0.2
pct. 75 = 1

Within Agreement, the average response is positive, a majority of folks respond 1 sd above Neutral. With Engagement, we see a a mean of 0.6, which is right at "neutral" and a more normal distribtuion from there. 

```{r}

mapping_63 <- scaled_sum %>% 
  drop_na(x63_fishing_in_reserve)


```



I want to see how many people said "yes" here: 

```{r}

counts_63 <- scaled_sum %>% 
  count(x63_fishing_in_reserve, country)

filtered_63 <- scaled_sum %>% 
  filter(x63_fishing_in_reserve == "1")

ggplot(data = filtered_63,
                      aes(x = agree_mean, y = eng_mean)) +
  geom_point(color = "darkblue", size = 1.2, alpha = 1,
             show.legend = TRUE) +
labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engange and Agreement of Admitted rule-breakers") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  theme_bw() 


```
*Figure 4: A graph of Agreement and Engagement measures, colored by responses of "Do you fish inside the reserve?" These fishers range * 

Question 63 asks if fishers break the rules, and fish in the reserve. This would be a classic measure of compliance (although self-reporting likely leads to a lower N of admitted non-compliers)

*138* fishers admitted that they fish in the reserve, while 2800 said they do not. The question we're left with is: What is different about folks who *admit* to breaking rules? These "Yes" rule-breakers are spread relatively evenly across all countries. 
Maybe they don't think there are sanctions, their community doesn't care about it

I'll do the same "rule-breaker" analysis, but against the question, "Out of 10 people in your community, how many people…Fished in the reserve in the last month"

`51b_fishers_reserves`

```{r}
breaking_rules <- 
  scaled_sum %>% 
  drop_na(x51b_fishers_reserves) %>% 
  select(x51b_fishers_reserves, eng_mean, agree_mean) %>% 
  filter(x51b_fishers_reserves != 82)

breaking_rules_1 <- ggplot(data = breaking_rules,
                      aes(x = agree_mean, y = eng_mean, color = x51b_fishers_reserves)) +
   geom_point(size = 0.7, alpha = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 6 Questions)",
      title = "Engagement and Agreement Index Mapping") +
#  scale_color_viridis(discrete = TRUE, option = "D") +
    scale_x_continuous(limits = c(-3, 1.7),
                      breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  scale_color_viridis( option = "D") +
  theme_bw() 


more_breaking_rules <- 
  scaled_sum %>% 
  drop_na(x51b_fishers_reserves) %>% 
  select(x51b_fishers_reserves, eng_mean, agree_mean) %>% 
  filter(x51b_fishers_reserves != 82) %>% 
  filter(x51b_fishers_reserves >= 5)

breaking_rules_2 <- ggplot(data = more_breaking_rules,
                      aes(x = agree_mean, y = eng_mean, color = x51b_fishers_reserves)) +
   geom_point(size = 0.7, alpha = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 6 Questions)",
      title = "Engagement and Agreement Index Mapping") +
#  scale_color_viridis(discrete = TRUE, option = "D") +
    scale_x_continuous(limits = c(-3, 1.7),
                      breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  scale_color_viridis( option = "D") +
  theme_bw() 



```
What do I see here? 

Figure 5a. The left-most observations report that their neighbors all or mostly fish in the reserve. 
- We see the "10" response (everyone fishes in the reserve) in every section of the map. Very few in the fully-agreeing section, but some average fishers and highly-engaged fishers, respectively, perceive high rule-breaking in their fishing reserve. 
- The majority of responses say between 0 and 3 (out of 10) of their neighboring fishers fish within the reserve boundary.

Figure 5b.: *This is really interesting!* 

Here we only see responses of fishers who perceived that more than half of their community fishes in the no-take reserve. 
The very-low agreement observations are here, but many high-engagement fishers alsos ay that 10/10 neighbors fish in the reserve. 
Do they just think that practice is OK? Or might they be engaged to try and curb those efforts? Engaged folks maybe see the reality a bit better than those who are "hopeful" about conservation? fascinating. 




##### Measuring Brazil
*After a sensitivity analysis, we now include 756 Brazilian observations*

Previously, Brazil was excluded, due to question we included in the Agreement index (Q64) that was not asked in Brazil.

- There are 1592 observations from Brazil
- Brazilian fishers were not asked questions 62 and 64
- When we filter for our remaining Index questions, we end up with 


```{r}
brazil <- hhs_all_complete %>% 
  data.frame() %>% 
  clean_names() %>% 
  filter(country == "BRA") %>% 
  drop_na(x44_meeting_attendance, x45_leadership_position,
x48_enforcement_participation,  x53_encourage_regulations,
 x61g_fishing_change_behavior,
            x43_ma_benefits, x46_represent_interests,  x52_ma_benefit_5yrs, x53_encourage_regulations, x61a_current_regulations, x61f_rights_distribution_fair,
x30_trust_local_decision)


```
We retained `x30_trust_local_decision` but excluded `x67_reserve_boundry` which only 11 responses. Now our fuller indices include 819 observations from Brazil. 



----
*Side note, there was curiosity if we could use a predictive model*
Potential Regression Model: 
[https://stats.idre.ucla.edu/r/dae/multinomial-logistic-regression/]


##### Statistical Summaries of Agreement and Engagement

Making some tables and graphs for Claudia + Rare: 


```{r}

hhs_scaled_character <- hhs_scaled %>% 
  as.character(c(24:34))
  

engage_scaled_sum <- hhs_scaled %>%
  select(24:28)
  
st(engage_scaled_sum)


agree_scaled_sum <- hhs_scaled %>% 
  select(29:33)


st(agree_scaled_sum)
```

Great, here we see basic statistics for each component of these two indices! 


#### Cluster Analysis witk `NbClust` and K-means Clustering

After some exploratory work, we understood that a distance-based clustering method first. If possible we want to see common combinations of answers. 

The following doesn't show up in cluster analysis, but I'd be interested to see...


Basically, it's going to run 30 different ways of evaluating how many clusters it *thinks* exist, then tell you the breakdown of what they decide (e.g. "8 algorithms think that there should be 4 clusters").

`NbClust::NbClust()`

First I create a df with *only* the 10 columns of A/E questions, since this is all that I want to include in the `NbClust` K-means analysis. 
```{r}
agree_engage_only_scaled <- scaled_sum %>% 
  select(24:34) %>% 
  scale()


agree_engage_leveled <- raw_index_leveling %>% 
  select(2:11) 

raw_index_leveling

```


#### Confirmatory Factor Analysis 
using `agree_engage_only` df
```{r}

agree_engage_leveled

model1 <-  'f1  =~  x44_meeting_attendance +
                    x48_enforcement_participation +
                      x53_encourage_regulations + 
                    x61g_fishing_change_behavior +
             x43_ma_benefits + 
                    x52_ma_benefit_5yrs +
                    x61a_current_regulations +
                    x46_represent_interests +
              x61f_rights_distribution_fair'



fit <- cfa(model1, data = agree_engage_leveled, std.lv=TRUE)
summary(fit, standardized = TRUE, fit.measures = TRUE)


lavaan::modindices(fit, minimum.value = 10, sort = TRUE)
```
Taking notes on CFA 
- Std. all = "beta values" 
- We have pretty low 

Return to this link when I want to plot the fit model 
[https://www.youtube.com/watch?v=aQiFJcEWBLo]

###### HERE is the correct, scaled, cluster analysis. 
```{r}
# number_est <- NbClust(agree_engage_only_scaled[], min.nc = 2, max.nc = 5, method = "kmeans")



set.seed(8)

 scaled_km <- kmeans(agree_engage_only_scaled, 4)


## The 5 means the amount of clusters we're looking at


  scaled_km
  

```
Below we can look at the "centers," although they are scaled numbers, I'll remake a table with the actual values 

```{r}
 cl_table_df <- data.frame(scaled_km$size,scaled_km$centers)
```


Below, I make a df that adds the Cluster Number `cluster_no` to the large   `scaled_sum` df

```{r}
cluster_df<- data.frame(scaled_sum, cluster_no = factor(scaled_km$cluster))   
```



```{r}
ggplot() +
  geom_point(data = cluster_df,
       aes(x = agree_mean, y = eng_mean,
           color = cluster_no),
           size = 0.7, alpha = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mapping Clusters",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))
```


It's time to decide if there are 4 or 3 Clusters. 
When we pick 4, we see 2 overlapping clusters in the lower right. One looks to be a bit more agreeing, and includes the folks who are fully agreeing. 






```{r}


set.seed(3)

 scaled_km_4 <- kmeans(agree_engage_only_scaled, 4)

## The 5 means the amount of clusters we're looking at


  scaled_km_4
  
  
 df_4_km <- data.frame(scaled_sum, cluster_no = factor(scaled_km_4$cluster))   
  

```

--
----
-------
----
--
The K-means clustering process is done, now I'll make some tables and a visualization of the A/E map, with Clusters as colors. This will begin to demonstrate how the fisher responses separate into different "types."


```{r}

 
 scaled_km_df <- data.frame(scaled_sum, cluster_no = factor(scaled_km$cluster)) 

cluster_summary_df <- scaled_km_df %>% 
  group_by(cluster_no) %>% 
  summarise(eng_mean = mean(eng_mean),
            agree_mean  = mean(agree_mean),
            x44_mean = mean(x44_meeting_attendance),
            x45_mean = mean(x45_leadership_position),
            x48_mean = mean(x48_enforcement_participation),
            x53_mean = mean(x53_encourage_regulations),
            x61g_mean = mean(x61g_fishing_change_behavior), 
            x43_mean =  mean(x43_ma_benefits),
            x46_mean = mean(x46_represent_interests),
           x52_mean = mean(x52_ma_benefit_5yrs),
           x61a_mean = mean(x61a_current_regulations),
           x61f_mean = mean(x61f_rights_distribution_fair),
           x30a_mean = mean(x30_trust_local_decision),
           x44_median = median(x44_meeting_attendance),
            x45_median = median(x45_leadership_position),
            x48_median = median(x48_enforcement_participation),
            x53_median = median(x53_encourage_regulations),
            x61g_median = median(x61g_fishing_change_behavior), 
            x43_median =  median(x43_ma_benefits),
            x46_median = median(x46_represent_interests),
           x52_median = median(x52_ma_benefit_5yrs),
           x61a_median = median(x61a_current_regulations),
           x61f_median = median(x61f_rights_distribution_fair),
            x30a_median = median(x30_trust_local_decision)) %>% 
  mutate(across(where(is.numeric), ~ round(., 2)))
## Here, the last line of code rounds to the second decimal 

cluster_medians <- cluster_summary_df %>% 
  select(1, 14:23) 

cl_mean_graphable_df <- cluster_summary_df %>% 
  select(eng_mean, agree_mean, cluster_no)



scaled_cluster_counts <- scaled_km_df %>% 
  count(cluster_no)


ggplot() +
  geom_point(data = scaled_km_df,
       aes(x = agree_mean, y = eng_mean,
           color = cluster_no),
           size = 0.7, alpha = 0.7) +
   geom_point(data = cl_mean_graphable_df,
             aes(x = agree_mean, y = eng_mean,
          color = cluster_no),
           size = 6, shape = "triangle", show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mapping Clusters",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))



```
Figure X: Agreement and Engagement, colored by our clusters and their centers. 

```{r}


kmeans_kable <- head(cluster_summary_df) %>% 
kable( format = "html", caption = "Summary of Clusters") %>%
   kable_styling(bootstrap_options = "striped",
                full_width = F,
                position = "left") %>%
collapse_rows(columns = 3, valign = "middle")


kmeans_kable
```


Between Cluster 1 and 4 (our "average" fishers,) we see that C4 is a full sd higher on question 43 "Do you think there is any benefit to regulating fishing via a managed access area and a reserve area?"

Both C1 and C4 (average fishers) have higher values in question x61g (willingness to change fishing behavior for the sake of conservation,) and they slightly disagree with "encouraging others to follow regulations."

*Average* fishers aren't engaging much (including meeting attendance.) From an NGO perspective, if one wants to shift fisher behavior+attitudes, then try and bring the reluctant folks into the governance process.  



Looking at Question 43 for Clusters 1 and 4. 
I' make a df `checking_43` that dives into that survey question for the 2 clusters of interest.
```{r}
checking_43 <- scaled_km_df %>% 
  select(x43_ma_benefits, x43_scaled, cluster_no) %>% 
  filter(cluster_no %in% c('1', '4'))

checking_43_counts <- checking_43 %>% 
  group_by(cluster_no) %>% 
  count(x43_ma_benefits)
```

Per the metadata
*"43_ma_benefits: 1 (Yes), 0 (No), "*
100% of Cluster 1 sees No benefit
100% if Cluster 4 sees a benefit
In total, 6500 said no, 6200 said yes. 
Therefore, the means of exactly 1 and 0 are correct, because each clsuters has unanimous responses. 



Below are updated plots, by cluster (1/6/22)
```{r}

x45_clustered <- scaled_km_df %>% 
  group_by(cluster_no) %>% 
  count(x45_leadership_position)
```



##### Cluster 1 (Average fishers who don't attend)
```{r, include=FALSE}

cluster_1_df <- scaled_km_df %>% 
  filter(cluster_no == "1")

mean(cluster_1_df$eng_mean)
mean(cluster_1_df$agree_mean)
median(cluster_1_df$eng_mean)
median(cluster_1_df$agree_mean)

cluster_2_df <- scaled_km_df %>% 
  filter(cluster_no == "2")

mean(cluster_2_df$eng_mean)
mean(cluster_2_df$agree_mean)
median(cluster_2_df$eng_mean)
median(cluster_2_df$agree_mean)

cluster_3_df <- scaled_km_df %>% 
  filter(cluster_no == "3")

c_1_e_m <- mean(cluster_3_df$eng_mean)
mean(cluster_3_df$agree_mean)
median(cluster_3_df$eng_mean)
median(cluster_3_df$agree_mean)

cluster_4_df <- scaled_km_df %>% 
  filter(cluster_no == "4")

mean(cluster_4_df$eng_mean)
mean(cluster_4_df$agree_mean)

median(cluster_4_df$eng_mean)
median(cluster_4_df$agree_mean)

cluster_5_df <- scaled_km_df %>% 
  filter(cluster_no == "5")

mean(cluster_5_df$eng_mean)
mean(cluster_5_df$agree_mean)

median(cluster_5_df$eng_mean)
median(cluster_5_df$agree_mean)
```



##### Cluster-specific maps

Cluster 1
```{r}

c_1_mean <- cluster_1_df %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))

ggplot() +
  geom_point(data = cluster_1_df,
       aes(x = agree_mean, y = eng_mean,
           color = country),
           size = 1) +
  geom_point(data = c_1_mean,
             aes(x = agree_mean, y = eng_mean), 
           size = 6, shape = "triangle", alpha = 0.7, show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Cluster 1", 
      color = "Country") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))


 ggplot(data = cluster_1_df,
       aes(x = agree_mean, y = eng_mean)) +
  geom_bin2d(bins = 20) +
  scale_fill_continuous(type = "viridis") +
  theme_bw() +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Density of Cluster 1",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, -0.5, 0, 0.5, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, -0.5, 0, 0.5, 1, 2))





cluster_1_country_counts <- cluster_1_df %>% 
  count(country)

```
*Figure 7a: Cluster 1 centers at (-0.13,-0.23) and accounts for average fishers who don't see benefits from Managed-Access. They respond nuetrally or in disagreement to question 43, and therefore have an agreement ceiling of 1.8*


*7b: The density plot shows us that the several hundred observations lie near (0, -0.5) (of 1154 total.) These fishers have are generally disengaged and have average agreement. The exception is their view of MA benefits*


Notes: 
Agreement ranges -1.2 to 0.8 (ceiling) and engagement ranges -1.4 to 0.9, with a soft ceiling at 0.5; only a handful of observations are included above 0.5 on the Y-axis. 


*Country Note*
163 from Brazil seems high.
23 from Honduras seems low. 
873 from PHL


Cluster 2 
```{r}
c_2_mean <- cluster_2_df %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))

c2_country_counts <- cluster_2_df %>% 
  count(country)

ggplot() +
  geom_point(data = cluster_2_df,
       aes(x = agree_mean, y = eng_mean,
           color = country),
           size = 1) +
  geom_point(data = c_2_mean,
             aes(x = agree_mean, y = eng_mean), 
           size = 6, shape = "triangle", alpha = 0.7, show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Cluster 2", 
      color = "Country") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))

ggplot(data = cluster_2_df,
       aes(x = agree_mean, y = eng_mean)) +
  geom_bin2d(bins = 20) +
  scale_fill_continuous(type = "viridis") +
  theme_bw() +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Density of Cluster 2",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2))
```
*Figure 8a: Cluster 2 are the resistant fishers. A handful of them are quite engaged, but cannot fit in another cluster, due simply to their disagreement below -1. The cluster has a mean of (-0.87, -0.42.) It also has the largest range of any cluster. Agreement ranges between -2.76 and 0.1. Meanwhile, engagement ranges from -1.55 to 1.4. N = 741*.

*8b: This is a smaller cluster, with a hotspot at (-1, -0.5) and just below (on the Y-axis.) * 

The Neutral fisher is in this cluster, interestingly. 

Country Notes
- Many of the super-unengaged  (bottom of graph)fishers come from Brazil. 
It's possible that there are less meetings to go to; 234 total in the cluster
- Many super-disagreeing fishers come from Honduras, 135 total
- 224 from Philippines, which is only 8% of the 2559 total. 

40% of Honduras and Brazil are in this resistant cluster

- BRA 234 of 573 (41%)
- HND 135 of 339 (40%)
- IDN 46 of 146 (32%)
- FSM 15 of 23 (65%)
- MOZ 83 of 669 (12%) Nice work MOZ
- PHL  of 2559 (9%)
- PLW  of 37 (8%)



Cluster 3
```{r}
c_3_mean <- cluster_3_df %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))

c3_country_counts <- cluster_3_df %>% 
  count(country)


ggplot() +
  geom_point(data = cluster_3_df,
       aes(x = agree_mean, y = eng_mean,
           color = country),
           size = 1) +
  geom_point(data = c_3_mean,
             aes(x = agree_mean, y = eng_mean), 
           size = 6, shape = "triangle", alpha = 0.6, show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Cluster 3", 
      color = "Country") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))



# Density time
ggplot(data = cluster_3_df,
       aes(x = agree_mean, y = eng_mean)) +
  geom_bin2d(bins = 20) +
  scale_fill_continuous(type = "viridis") +
  theme_bw() +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Density of Cluster 3") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2))

```
*Figure 10: Cluster 3 is the commitment cluster; they agree with fishery conservation and participate in local management. A few of them are below the mean for engagement, and some moderately disagreeing fishers also find themselves here. With a mean of (0.30, 0.87,) these respondents stand out as the attitudes that Rare wants to see (after campaign implementation.) N = 1002* 

Engagement ranges -0.28 (only 1% are below 0) to 1.59.
Agreement ranges -1 to 1. 1/3 of all observations are below 0
...We see that engagement is what separates the "committed" folks from the pack. 

Highest density lies at (0,1.) However, we see a vertical density at 0.5 agreement, ranging from 0.5 to 1.25. The grand majority of the cluster lies in this range, with smaller groups at the maximum scores for engagement and agreement. Reminder that to have an engagement "maximum" these people volunteer for enforcement, attend meetings, and have some type of leadership role. 

Country Notes (hypothesis= PHL dominates)
- 311 from MOZ (that's a lot for them, 46% of the 669!)
PHL is equally proportioned, while Brazil is extremely low, as is Honduras.


- BRA 30 of 573 (5%)
- HND 25 of 339 (7%)
- IDN 37 of 146 (25%)
- FSM 2 of 23 (8%)
- MOZ 311 of 669 (46%)
- PHL 582 of 2559 (34%)
- PLW 15 of 37 (41%)




Cluster 4

```{r}
c_4_mean <- cluster_4_df %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))


c4_country_counts <- cluster_4_df %>% 
  count(country)


ggplot() +
  geom_point(data = cluster_4_df,
       aes(x = agree_mean, y = eng_mean,
           color = country),
           size = 1) +
  geom_point(data = c_4_mean,
             aes(x = agree_mean, y = eng_mean), 
           size = 6, shape = "triangle", alpha = 0.6, show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Cluster 4", 
      color = "Country") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))

ggplot(data = cluster_4_df,
       aes(x = agree_mean, y = eng_mean)) +
  geom_bin2d(bins = 20) +
  scale_fill_continuous(type = "viridis") +
  theme_bw() +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Density of Cluster 4") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2))

```
*11a: Only a few fishers are below -1 engagement, while agreeing this much. They agree more(?) that Cluster 1, but otherwise look close to identical. Mean = (0.314, -0.18) N = 1554, largest group.* 

*11b: There is a sparse line of these unengaged fishers who agree completely with rules. The majority though find themselves between 0 and 1 for agreement (pretty high!) and between -0.5 and 0.5 for engagement. Most of those are below 0. Density is pretty unimodal*

Country Notes
- BRA 246 of 573 (37%)
- HND 156 of 339 (46%)
- IDN 49 of 146 (33%)
- MOZ 210 of 669 (31%)
- PHL 874 of 2559 (34)
- PLW 19 of 37 (51%)

2/3 are below neutral engagement. 





##### Country-specific cluster maps 

Philippines:
```{r}
cl_phil <- scaled_km_df %>% 
  filter(country == "PHL")


ggplot(cl_phil,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Phillipines Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_phil_count <- 
  cl_phil %>% 
  count(cluster_no)

```

Eye Test
- Very few observations below -1 in agreement. 
- Clear mix across C1 and C4. 
- Strong contingency of C3 (committed fishers)


Indonesia: 

```{r}
cl_indo <- scaled_km_df %>% 
  filter(country == "IDN")


ggplot(cl_indo,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Indonesia Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))


cl_indo_count <- 
  cl_indo %>% 
  count(cluster_no)

```

Eye-Test
- Small N, why? 
- Barely any dots in C1, the average fishers who see no benefit to MA



Honduras
```{r}
cl_honduras <- scaled_km_df %>% 
  filter(country == "HND")

hnd_counts <- cl_honduras %>% 
  count(cluster_no)


ggplot(cl_honduras,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Honduras Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_hond_count <- 
  cl_honduras %>% 
  count(cluster_no)
```

Eye Test
- Huge spread of resistant fishers
- Very few from Cluster 1
- Includes some disagreeing folks who sit well above neutral engagement (creative fishers.)
- Even the Average fishers here are more engaged than other countries


```{r}
cl_micro <- scaled_km_df %>% 
  filter(country == "FSM")


ggplot(cl_micro,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Micronesia Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_micro_count <- 
  cl_micro %>% 
  count(cluster_no)
```



Mozambique

```{r}
cl_moz <- scaled_km_df %>% 
  filter(country == "MOZ")


ggplot(cl_moz,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mozambique Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_moz_count <- 
  cl_moz %>% 
  count(cluster_no)
```

Eye-test
- Mozambique is the most committed country.
How'd this come to be? Is MA better than previous management? 

```{r}
cl_brazil <- scaled_km_df %>% 
  filter(country == "BRA")

bra_counts <- cl_brazil %>% 
  count(cluster_no)


ggplot(cl_brazil,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Brazil Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_bra_count <- 
  cl_brazil %>% 
  count(cluster_no)
```


At first it looks like a full spread, but the majority lie between 0 and -1 engagement, and from there range widely across agreement. 




##### Correlation plots with `corrplot()`


```{r}
 engagement_only <- scaled_sum %>% 
  select(24:28)

corrplot(cor(engagement_only), main = "Engagement Question Correlations")

```
When running a correlation of all the *Engagement* questions, we see very little correlation across the different questions. We see correlations around 0 and 0.3, with no negative correlations. We find the *largest* correlation between questions 45 and 48 (0.5). 


Let's do the same with agreement, and all compliance questions together. 


```{r}


corrplot(cor(agree_scaled_sum), main = "Agreement Question Correlations")
```

Here we see really similar results to the Engagement corrplot. There are no dark blue or large circles. Again, we see no negative correlation, a lot of results between 0 and 0.2. 61(f) (fairness of distribution) and 61(a) (benefit of current regulations) have a slightly lager correlation, at 0.5 


Let's look at agreement AND engagement. This will look messy at first. 


##### Exploring relations between clusters and other variables (Plus hypotheses)


We want to see how other survey variables (other than the 10 compliance varaibles) correlate/interact with our cluster analysis. This includes:

- Income
- Food security
- Enforcement ("Who is responsible for enforcement?") 


*Starting with Enforcement* 
```{r}



enforcement_df <- scaled_km_df %>% 
  select(eng_mean, agree_mean, cluster_no, x49_enforcement_responsible, x51b_fishers_reserves, country) %>% 
filter(x49_enforcement_responsible %in% c("Fisheries Management Body",
                                         "Subnational Government",
                                         "No enforcement system",
                                         "Myself",
                                         "National Government", na.rm = FALSE))

### To make a grouped bar chart, I want counts for each cluster


enforcement_counts <- enforcement_df %>% 
  select(eng_mean, agree_mean, cluster_no, x49_enforcement_responsible, x51b_fishers_reserves, country) %>% 
  group_by(x49_enforcement_responsible) %>% 
  count(cluster_no)

  
swtiched_enforcement_counts <- enforcement_df %>% 
  group_by(cluster_no) %>% 
  count(x49_enforcement_responsible)
  
  
#  recode_factor(`44_meeting_attendance`, "" = "Fisheries Management Body"))
# recode_factor(`44_meeting_attendance`, "" = "Fisheries Management Body"))
# recode_factor(`44_meeting_attendance`, "" = "Fisheries Management Body"))
# recode_factor(`44_meeting_attendance`, "Subnational Government,Fisheries Management Body" = "Fisheries Management Body"))


### Data cleaning




ggplot(swtiched_enforcement_counts,
       aes(x = cluster_no, y = n, fill = x49_enforcement_responsible)) +
  geom_bar(position="dodge", stat="identity") +
  labs( x = "Cluster #",
      y = "Enforcement",
      title = "Enforcement By Cluster", 
      Fill = "Enforcement Type") +
    guides(colour = guide_legend(override.aes = list(size=7))) 


  # scale_x_continuous(limits = c(-3, 2),
  #                    breaks = c(-2, -1, 0, 1, 2)) +
  #  scale_y_continuous(limits = c(-1.5, 2),
  #                    breaks = c( -1, 0, 1, 2)) +



ggplot(enforcement_counts,
       aes(x = x49_enforcement_responsible, y = n, fill = cluster_no)) +
  geom_bar(position="dodge", stat="identity", alpha = 0.8) +
  labs( x = "Enforcement Responsibility",
      y = "Cluster",
      title = "Enforcement By Cluster", 
      color = "Cluster") +
  geom_text(aes(label = n),position = position_dodge(0.9), vjust = 1, size = 2, color = "gray1") +
    guides(colour = guide_legend(override.aes = list(size=7))) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))


```

"Who is responsible for enforcement in
your community?
1. Fisheries Management Body
2. National Government
3. Subnational Government
4. Other (please state)
5. There is no enforcement system"


##### Comparing enforcement with Perceived Fish catch (Q19)


```{r}

enforcement_and_catch <- scaled_km_df %>% 
  select(cluster_no, x19_current_fish_catch, x49_enforcement_responsible) %>% 
  filter(x49_enforcement_responsible %in% c("Fisheries Management Body",
                                            "National Government", 
                                            "Subnational Government", 
                                            "No enforcement system", 
                                            "Myself")) %>% 
  drop_na()

x19_over_49 <- enforcement_and_catch %>% 
  group_by(x49_enforcement_responsible) %>% 
  count(x19_current_fish_catch)

x49_over_19 <- enforcement_and_catch %>% 
  group_by(x19_current_fish_catch) %>% 
  count(x49_enforcement_responsible)

```


I'll visualize the two, and verbalize + write what what each ones tells us (i.e. what's different between the two.)

```{r}
ggplot(x19_over_49,
       aes(x = x19_current_fish_catch, y = n, fill = x49_enforcement_responsible)) +
  geom_bar(position="dodge", stat="identity", alpha = 0.8) +
  labs( x = "Enforcement Responsibility",
      y = "N",
      title = "Enforcement Against Perceived Catch", 
      fill = "Enforcement Responsibility") +
  geom_text(aes(label = n),position = position_dodge(0.9), vjust = 1, size = 2, color = "gray1") +
    guides(colour = guide_legend(override.aes = list(size=7))) +
  theme(axis.text.x = element_text(angle = 45, hjust=1)) +
  scale_fill_viridis(discrete = T) 

### Switching Axes
ggplot(x49_over_19,
       aes(x = x49_enforcement_responsible, y = n, fill = x19_current_fish_catch)) +
  geom_bar(position="fill", stat="identity", alpha = 0.8) +
  labs( x = "Enforcement Responsibility",
      y = "N",
      title = "Enforcement Against Perceived Catch", 
      fill = "Perceived Catch Change") +
  geom_text(aes(label = n),position = position_fill(0.9), vjust = 1, size = 2, color = "gray1") +
    guides(colour = guide_legend(override.aes = list(size=7))) +
  theme(axis.text.x = element_text(angle = 45, hjust=1)) +
  scale_fill_viridis(discrete = T) 


```

What do we see? 

When the X bins are Enforcement type, I think we see a better picture. Asking "how many folks, udner subnational enforcement saw no change if fish catch?" is easier than "OK, among those who saw a slight decline, how many have no enforcement system?" 
 
We start with the institution (albeit perceived) and then step into the personal perception fo fish catch over time. 

- FMB-responsibility has the highest amount of "improved (relative and absolute)
- Subnational ahd the msot "Stayed the Same" (relative)
- No enforcement or "myself" had the higher proportions of "Declined a lot." 



Let's get some count data (classic post-visualization move)

```{r}


enforcement_wider <- enforcement_counts %>% 
  pivot_wider(names_from = x49_enforcement_responsible, 
              values_from = n) %>% 
 bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "Total"))


enforcement_kable_1 <- head(enforcement_wider) %>% 
  kable( format = "html", caption = "Enforcement") %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "left") %>% 
collapse_rows(columns = 3, valign = "middle")



enforcement_kable_1

  

```

First note: what does "Subnational Government" mean? 


Comparing "Subnational government" and "No enforcement system"


```{r}
three_filter_enforcement <- enforcement_df %>% 
  filter(x49_enforcement_responsible %in% c("Subnational Government",
                                            "National Government",
                                            "No enforcement system"))

ggplot(three_filter_enforcement,
       aes(x = agree_mean, y = eng_mean, color = x49_enforcement_responsible)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Enforcement and Complaince (National, Subnational, and No Enforcement", 
      color = "Enforcement Type") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  scale_color_manual(values = c("gold", "darkgreen", "blue"))


no_enforcement <- enforcement_df %>% 
  filter(x49_enforcement_responsible == "No enforcement system")

st(no_enforcement)


```

No enforcement system lacks engaged folks, perhaps because they cannot volunteer for enforcement 
There is more high agreement among fishers who believe that their National Government is responsible for fishery enforcement
The very-unengaged (<1 -1) have an even spread across the 3 types. 
The very-engaged (>1) all have some sort of enforcement system. 





```{r}

comparing_enforcement <- enforcement_df %>% 
  filter(x49_enforcement_responsible %in% c("Fisheries Management Body",
                                         "Subnational Government",
                                         "National Government", na.rm = FALSE))



ggplot(data = comparing_enforcement) +
  geom_point(aes(x = agree_mean, y = eng_mean, color = cluster_no), size = 0.6) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  labs( title = "Three Main Enforcement Responsibilities") +
  facet_wrap(~x49_enforcement_responsible)

```
Color-blind Dyl here, uh oh! I'm going to need to see some tables 
FMP has fewer fishers who heavily disagree. That said, I can't see much from these graphs so far, other than the interpretations from the bar graph.  



OK! Dad wants to see boat ownership 
Hypothesis: Fishers without boats are less likely to engage

```{r}
boat_ownership <- scaled_km_df %>% 
  select(eng_mean, agree_mean, x21_boat_owner_status, cluster_no, x23_job_secure, country, x49_enforcement_responsible, x11d_income_fishing_industrial, x11c_income_fishing_artisanal)

boat_counts <- boat_ownership %>% 
  group_by(cluster_no) %>% 
  count(x21_boat_owner_status)


ggplot(boat_counts,
       aes(x = x21_boat_owner_status, y = n, fill = cluster_no)) +
  geom_bar(position="fill", stat="identity") +
  labs( x = "Boat Ownshership",
      y = "Cluster",
      title = "Oh, you got a boat?", 
      color = "Cluster") +
    guides(colour = guide_legend(override.aes = list(size=7))) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))



```
*Figure X:    *


- When the collective owns a boat, C4 dominates, C2 (super-engaged) shrinks
- When fishers share boats "as an employee" (meaning their boss owns a boat?) there are more resistant fishers. 
- Fishers who own their own boat have a larger contingent of Cluster 1
- Renters are the most "super-engaged" (C2) and least resistant (C5)

Let's break this down by country, to check if boat status and country are heavily correlated 

```{r}

boats_by_country <- boat_ownership %>% 
  filter(country != "PHL") %>% 
  group_by(x21_boat_owner_status) %>% 
  count(country)

ggplot(boats_by_country,
       aes(x = x21_boat_owner_status, y = n, fill = country)) +
  geom_bar(position="fill", stat="identity") +
  labs( x = "Boat Ownshership",
      y = "Country",
      title = "Who got boats?", 
      color = "Country") +
    guides(colour = guide_legend(override.aes = list(size=7))) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))

```
A lot of renting on Honduras! 
Mozambique and Brazil have a lot of collective ownership 
Brazil also has a lot of boat owners 
Mozambique has the highest percentage of fishers who fish without boats, even more than Brazil (where I know many fishers collect crabs and other invertebrates)


##### Visualizing Need + Food Security  


**HHS questions that relate to Need**

- Question #23: "Do you believe that the job of a fisher is secure in the future?"  
- Question #26: "Does your income provide enough to save?"
- Question #28: "Does your household take out loans from fish buyers or traders?"
- Question #29: "To cover family needs your household income is…"
- Question #54: "How do you rate the last year in terms of food availability?"
- Question #55: "Consider the following statement: ”I worry about not having enough food for everyone in the household” Was that often, sometimes or never true for you in the last 12 months?" 
- Question #59: "Are you confident that you will be able to procure enough food for you and your family for the next 12 months?" 
- Question #60: In the last 12 months, how often did your household eat fish?


Starting with 55 and 56

```{r}
food_security <- scaled_km_df %>% 
  select(country, cluster_no, x23_job_secure, x26_fishing_income_save, x28_buyer_loans, x29_family_income, x55_worry_food, x59_food_procurement, x60_hh_fish_consumption, eng_mean, agree_mean) %>% 
  drop_na()
```

This is going to be a bunch of visuals, and some comparison to see what's actually shown in the data. 


Dyl's hypotheses:
- Fishers with limited funds are less engaged, but vary evenly across agreement
- Fishers who eat lots of seafood are more engaged than those who don't 
- Cluster 2 (agreers) make more money than Clusters 1 and 4 (average)


```{r}
ggplot(food_security,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Food Security Ability", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  facet_wrap(~x23_job_secure)


job_security_counts <- food_security %>% 
  group_by(cluster_no) %>% 
  count(x23_job_secure) 
```
Cluster 1: 55% job secure
Cluster 2: 46% job secure
Cluster 3: 72% job secure
Cluster 5: 65% job secure



Question 29 "To cover family needs
your household income
is…"  [Sufficient, Tight, Insufficient]
```{r}
ggplot(food_security,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Ability to cover family costs", 
      color = "Cluster", 
      caption = "Hypothesis: Those with sufficient funds engage more, agree similarly") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  facet_wrap(~x29_family_income)

##looking at percentages now, to see another bar plot. 

## First, income counts by Cluster
income_counts <- food_security %>% 
  group_by(cluster_no) %>% 
  count(x29_family_income)


ggplot(income_counts,
       aes(x = cluster_no, y = n, fill = x29_family_income)) +
  geom_bar(position="dodge", stat="identity", alpha = 0.8) +
  labs( x = "Clusters (1 and 4 are 'average')",
      y = "Total # of Fishers",
      title = "Ability to cover family costs", 
      fill = "Household funds are..", 
      caption = "Hypothesis: insufficient funds = less engaged") +
  geom_text(aes(label = n),position = position_dodge(0.9), vjust = 2, size = 2, color = "gray1")+
  theme_bw()





```
Let's look at some count numbers (percentages are numbers!)

Ask T about this!


Since need (so far) isn't correlating much with any particular level of compliance, let's see how people who are dependent on seafood comply: 


```{r}

seafood_clean <- food_security %>% 
  drop_na(x60_hh_fish_consumption)

ggplot(seafood_clean,
       aes(x = agree_mean, y = eng_mean, color = x60_hh_fish_consumption)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Seafood Dependence", 
      color = "Cluster", 
      caption = "Hypothesis: People who eat more fish are more engaged") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7))) 



seafood_counts <- seafood_clean %>% 
  group_by(cluster_no) %>% 
  count(x60_hh_fish_consumption) %>% 
 pivot_wider(names_from = cluster_no, values_from = n) 




```

Even looking at counts, we're seeing another variable without any correlation - this is kinda crazy! 

What if - nothing really drives compliance behaviors other than simply attitudes about compliance? 

... There are plenty more variables to explore before we truly wonder that, though. 

Let's look at `x55_worry_food` 
```{r}



ggplot(food_security,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Financial Insecurity", 
      color = "Cluster", 
      caption = "Hypothesis: Food insecurity = less agreeing") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  facet_wrap(~x55_worry_food) +
   scale_color_discrete("blue", "goldenrod", "red4")


```
"Consider the following statement: ”I worry about not having enough food for everyone in the household” Was that often, sometimes or never true for you in the last 12 months?" 
Alright, now we see some spread.

Those who "often" worry about food are MORE engaged and also the most resistant. Comapred to "never."

People who "never" worry about food security skew towards lower engagement. 

This is challenging because there is a far larger N within "sometimes," but we can compare the differences of "Never" and "Often." Never has some very disagreeing fishers, who engage a little (willing to change behavior, likely) 

Those who often worry about food have a lot of somewhat engaged, rather agreeing folks. Let's do some stats here. 





##### Corrplots for many variables 


```{r}

first_correlate_df <- scaled_km_df %>% 
  select(agree_mean, eng_mean, x55_worry_food, x11b_income_harvesting, x11c_income_fishing_artisanal, x11d_income_fishing_industrial, x11e_income_buying_trading, x11f_income_processing, x11g_income_aquaculture, x11h_income_extraction, x11i_income_tourism, x38_reserve_fishing_allowed, x39_ma_boundaries_aware, x50_ma_punishment, x61b_catch_recording, x61c_community_participation, x61d_strong_enforcement, x61h_individual_behavior, x61i_help_neighbors, x62_reserve_compliance, x63_fishing_in_reserve, x64_wrong_fishing_reserve, x50_ma_punishment, x55_worry_food, x59_food_procurement) %>% 
 
   mutate(x39_ma_boundaries_aware = recode_factor(x39_ma_boundaries_aware, 
      "Strongly agree" = 5,
      "Agree" = 4,
      "Neither" = 3,
      "Disagree" = 2, 
      "Strongly disagree" = 1)) %>% 
  filter(x39_ma_boundaries_aware != c("No reserve", "No managed access", "NA")) %>% 
  filter(x50_ma_punishment != c("No management", "NA", "na")) %>% 
  mutate(x50_ma_punishment = recode_factor(x50_ma_punishment,
                          "Severe"= 5,
                          "Strong" = 4, 
                          "Moderate" = 3, 
                          "Weak" = 2,
                          "No punishment" = 1)) %>% 
  drop_na(x55_worry_food) %>% 
  mutate(x55_worry_food = recode_factor(x55_worry_food, 
                                        "Often" = 1,
                                        "Sometimes" = 0, 
                                        "Never" = -1)) %>% 
  drop_na(x59_food_procurement) %>% 
  mutate(x59_food_procurement = recode_factor(x59_food_procurement,
                                              "Certain" = 5,
                                              "High chance" = 4, 
                                              "Uncertain" = 3,
                                              "Not confident" = 2, 
                                              "Confident not" = 2, 
                                              "Very confident not" = 1,
                                              "Very not confident" = 1)) %>% 
  mutate(x39_ma_boundaries_aware = as.numeric(x39_ma_boundaries_aware)) %>% 
  mutate(x50_ma_punishment = as.numeric(x50_ma_punishment)) %>% 
  mutate(x55_worry_food = as.numeric(x55_worry_food)) %>% 
  mutate(x59_food_procurement = as.numeric(x59_food_procurement)) %>% 
  mutate(x64_wrong_fishing_reserve = as.numeric(x64_wrong_fishing_reserve)) %>% 
  mutate(x62_reserve_compliance = as.numeric(x62_reserve_compliance))




# x39 was changed to 1-5, NAs dropped
# x50 was changed to 1-5, NAs dropped
# x55 changed to -1/1, NAs dropped
# x59 changed to  1-5, NAs dropped




corrplot(cor(first_correlate_df, use="pairwise.complete.obs", method = "spearman"))

corrplot(cor(first_correlate_df, use="pairwise.complete.obs"), type = "lower", method = "color", col=brewer.pal(n=8, name="PuOr"))

   #    method="number", 
                   # order="hclust", 
                   # addrect=2, 
                   # diag=F,
```

Correlation with Engagement/Agreement:(N = Negative, P = Positive, options of strength = c(week, moderate, strong)) [E/A]
- x11e (P, weak) [E]


- x61c (P, weak) [E]
- x61d (P, weak) [E]
- x61h (N, weak) [E]
Weak, negative correlation with Engagement: x55, x11b, x11d, x11f, x11h, x11i, x39, x50, x61h, x63, x64
Agreement:
- x61c (P, weak) [A]
- x61d (P, weak) [A]
- x61h (P, weak) [A]
- x61i (P, weak) [A]
- x64 (N, moderate) [A]
- x11h (N, moderate) [A]
x39 (N, moderate) [A]
Weak negative correlation with agreement: 
11b, 11c, 11d, 11f, 11g, x62, x63

Other interesting correlations
- x64 (wrong to fish in the reserve) and x11h (income from extraction) (P, moderate)
- x61d (strong enforcement) and x11h (income form extraction) (N, moderate)
- Strong negative correlation between 11i and 11h (tourism and extraction incomes)
- x64 has negative correlations with x61c and x61c (community participation and strong enforcement)
- x61c through x61 i have moderate positive correlations



Making a table of all these variables, by cluster 




Let's compare question 19 across the axes and the clusters

```{r fig.height=10, fig.width=12}

no_na_19 <- scaled_km_df %>% 
    drop_na(x19_current_fish_catch) %>% 
 mutate(x19_current_fish_catch = recode_factor(x19_current_fish_catch, 
    "Declined a lot" = "1. Declined a lot",
          "Declined slightly" = "2. Declined slightly",
           "Stayed the same" = "3. Stayed the same",
          "Improved slightly" = "4. Improved slightly",
          "Improved heavily" = "5. Improved heavily")) 
  


       
         
         
mean_19_df <- no_na_19 %>% 
        group_by(x19_current_fish_catch) %>% 
        summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean)) 
         

ggplot(no_na_19,
       aes(x = agree_mean, y = eng_mean, color = x19_current_fish_catch)) +
  geom_point() +
 geom_point(data = mean_19_df,
             aes(x = agree_mean, y = eng_mean), color = "black",
           size = 5, shape = "triangle", show.legend = FALSE)+
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Perceived Ecological Change", 
      color = "Change in Fish Stock (perceived)", 
      caption = "Hypothesis: fish decline = Less Agreeing") +
  guides(colour = guide_legend(override.aes = list(size=7))) + 
  facet_wrap(~x19_current_fish_catch)



```

```{r}
ggplot(no_na_19,
       aes(x = agree_mean, y = eng_mean, color = x19_current_fish_catch)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Perceived Change in Catch", 
      color = "Change in Fish Catch (perceived)", 
      caption = "Hypothesis: fish decline = Less Agreeing") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7))) 

```



Eye-test notes: 



For me, I'd like to see some counts 

```{r}
x19_counts <- no_na_19 %>% 
  count(x19_current_fish_catch)

x19_cluster_counts <- no_na_19 %>% 
  group_by(cluster_no) %>% 
  count(x19_current_fish_catch)


ggplot(x19_cluster_counts,
       aes(x = x19_current_fish_catch, y = n, fill = cluster_no,
           )) +
  geom_bar(position="fill", stat="identity") +
  labs( x = "Perception of Fish Stock (over last 2 years)",
      y = "Percentage",
      fill = "Cluster") +
    guides(colour = guide_legend(override.aes = list(size=7))) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust=1))

reversed_x19_counts <- 
  no_na_19 %>% 
  group_by(x19_current_fish_catch) %>% 
  count(cluster_no)

ggplot(reversed_x19_counts,
       aes(x = cluster_no, y = n, fill = x19_current_fish_catch)) +
  geom_bar(position="fill", stat="identity") +
  labs( x = "Clusters",
      y = "Percentage of Cluster",
      title = "Perceived Catch and Clusters", 
      fill = "Perceived Fishery Status") +
  theme_classic()

```
Here's a breakdown of the ecology question:




Cluster 1 saw mostly declines (466/677)
Cluster 2 has the most who saw slight improvements 
Cluster 3


I just want to check the counts of x19 by country
```{r}
x19_by_country <- no_na_19 %>% 
  group_by(country) %>% 
  count(x19_current_fish_catch)

ggplot(x19_by_country) +
  geom_bar( aes(x = country, y=n, fill = x19_current_fish_catch), stat="identity", alpha=0.8) +
  theme_bw() +
  labs(fill = "Perceived Fish Catch")

x19_sans_phl <- no_na_19 %>% 
  filter(country != "PHL") %>% 
    group_by(country) %>% 
  count(x19_current_fish_catch)

ggplot(x19_sans_phl) +
  geom_bar( aes(x = country, y=n, fill = x19_current_fish_catch), stat="identity", alpha=0.8) +
  theme_bw() +
  labs(fill = "Perceived Fish Catch")

```

##### Showing Worded responses to each Engagement/Agreement Question, for each cluster 


```{r}

median_cluster_df <- scaled_km_df %>% 
  select(country, cluster_no, 24:33) %>% 
  group_by(country) %>% 
summarise_if(is.numeric, median) %>% 
mutate(x44_meeting_attendance = recode_factor(x44_meeting_attendance, "1" = "Yes",
                                              "-1"  = "No",
                                              "0" = "Not sure")) %>% 
  mutate(x45_leadership_position = recode_factor(x45_leadership_position, "1" = "Yes",
                                                 "-1"  = "No",
                                                 "0" = "Not sure")) %>% 
  mutate(x48_enforcement_participation = recode_factor(x48_enforcement_participation,
                                                       "1" = "Yes",
                                                       "-1"  = "No",
                                                       "0" = "Not sure")) %>%    mutate(x53_encourage_regulations = 
            recode_factor(x53_encourage_regulations,    "-2" = "Never",
                                                        "-1" = "Rarely",
                                                        "0" = "Sometimes",   
                                                        "2" = "Often",
                                                          "2" = "Very often")) %>% 
  mutate(x61g_fishing_change_behavior = 
            recode_factor(x61g_fishing_change_behavior, "1" = "Strongly disagree",
                                                        "2" = "Disagree",
                                                        "3" = "Neutral", 
                                                        "4" = "Agree",
                                                        "5" = "Strongly agree")) %>% 
  mutate(x61a_current_regulations = 
            recode_factor(x61a_current_regulations, "1" = "Strongly disagree",
                                                        "2" = "Disagree",
                                                        "3" = "Neutral", 
                                                        "4" = "Agree",
                                                        "5" = "Strongly agree")) %>% 
  mutate(x61f_rights_distribution_fair = 
            recode_factor(x61f_rights_distribution_fair, "1" = "Strongly disagree",
                                                        "2" = "Disagree",
                                                        "3" = "Neutral", 
                                                        "4" = "Agree",
                                                        "5" = "Strongly agree")) %>% 
  mutate(x43_ma_benefits = recode_factor(x43_ma_benefits, "1" = "Yes",
                                              "-1"  = "No",
                                              "0" = "Neutral/Unsure")) %>% 
  mutate(x46_represent_interests = recode_factor(x46_represent_interests, "1" = "Yes",
                                              "-1"  = "No",
                                              "0" = "Neutral/Unsure")) %>% 
  mutate(x52_ma_benefit_5yrs = recode_factor(x46_represent_interests, "1" = "Yes",
                                              "-1"  = "No",
                                              "0" = "Unsure")) 

### Separating this into Engagement and Agreement
median_engagement_df <-  median_cluster_df %>% 
  select(1:6)

median_agreement_df <- median_cluster_df %>% 
  select(1, 7:11)


median_engagement_df  %>% 
  kable(col.names = c("Country", 
                     "Meeting Attendeance", 
                     "Leadership Position", 
                     "Volunteer Enforcment",
                     "Willingness to encourage regulations",
                     "Willingness to change Behavior")) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "left"
                ) %>% 
  add_header_above(c("Median Engagement Response by County" = 6))



## Now using `kable` for the agreement table 
median_agreement_df %>% 
  
kable(col.names =  c("Country", 
                     "Benefits of Managed Access",
                     "Interests Represented",
                     "Benefit in 5 years",
                     "Regulations helping cactch",
                     "Fairness of fishing rights")) %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "left"
                ) %>% 
  add_header_above(c("Median Agreement Response by County" = 6))
  




```

Clusters with question 64: How wrong is fishing in the reserve? 

```{r}

three_part_64 <- scaled_km_df %>% 
  mutate(x64_wrong_fishing_reserve = recode_factor(x64_wrong_fishing_reserve, 
                                        "5" = "Very Wrong",
                                        "4" = "Very Wrong",
                                        "3" = "Slightly Wrong", 
                                        "2" = "Slightly Wrong",
                                        "1" = "Not Wrong",
                                        "0" = "Not Wrong")) 

ggplot() +
  geom_point(data = three_part_64,
       aes(x = agree_mean, y = eng_mean,
           color = cluster_no, shape = x64_wrong_fishing_reserve), size = 1.1, alpha = 0.8) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mapping Clusters",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7))) 

```


So, kind of everyone thinks its pretty wrong, huh. Also a ton of NAs, hard to limit that noise



```{r}

x63_clusters <- scaled_km_df %>% 
  filter(x63_fishing_in_reserve == "1")

ggplot(data = x63_clusters, aes(x = agree_mean, y = eng_mean,
           color  = x64_wrong_fishing_reserve),
           size = 0.7, alpha = 0.7) +
  geom_point(size = 1) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mapping Clusters of Rule-breakers",
      color = "Morality") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7))) 



```




```{r}
ggplot(data = scaled_km_df,
       aes(x = country, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.4) +
  geom_jitter(size = 0.4) +
   guides(colour = guide_legend(override.aes = list(size=7)))

```
Notes: 
- Resistant fishers are far more present in BRA, HND and PHL. However, HND and BRA both spread from the lowest to highest engagement possibilities. This mean there is OPPORTUNITY to be a leader, enforce, etc. 


Plotting clusters by gender
```{r}



gender_mean <- scaled_km_df %>% 
  group_by(x6_gender) %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))


ggplot() +
  geom_jitter(data = scaled_km_df, 
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(data = gender_mean, 
            aes(x = agree_mean, y = eng_mean), color = "black", size = 7, alpha = 0.6) +
   guides(colour = guide_legend(override.aes = list(size=7))) +
  facet_wrap(~x6_gender) 

```
Female mean = (-0.06947793, -0.03637067)

Male mean =  (0.04032597, 0.02179388)

This was not the case before! Were all within 0.1 of zero, to be clear. But when we add Brazil, the mean for men increases


##### Clusters and Question 4

```{r}
q_4_clustered <- scaled_km_df %>% 
  select(x4_ma_r_mb, cluster_no, eng_mean, agree_mean) %>% 
  drop_na(x4_ma_r_mb) %>% 
 group_by(cluster_no) %>% 
  count(x4_ma_r_mb)

ggplot(q_4_clustered) +
  geom_bar( aes(x = x4_ma_r_mb, y=n, fill = cluster_no), stat="identity", alpha=0.8) +
  theme_bw() +
  labs(fill = "MA Status")

```
Most places have "all 3," when they've answered all of our compliance questions. 


##### Basic Demographics and Clusters 


##### Fishing Effort

I'll clean up questions 17 and 18, and visualizae them against compliance behaviors

```{r}
fishing_effort_17 <- scaled_km_df %>% 
  filter(x17_fishing_low_profit %in% c("Once or never",
                                         "A few times",
                                         "A few times per month",
                                        "1-2 per week",
                                         "More than 1-2 times per week",
                                       na.rm = FALSE)) %>% 
  drop_na(x17_fishing_low_profit)

x17_counts <- fishing_effort_17 %>% 
  group_by(x17_fishing_low_profit) %>% 
  count()

x17_cluster_counts <- fishing_effort_17 %>% 
  group_by(cluster_no) %>% 
  count(x17_fishing_low_profit)
```

Let's visualize this, starting with scatterplot


```{r}
ggplot(data = fishing_effort_17,  aes(x = agree_mean, y = eng_mean)) +
   geom_point(aes(color = x17_fishing_low_profit), size = 0.7, alpha = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engagement and Agreement Index Mapping") +
#  scale_color_viridis(discrete = TRUE, option = "D") +
    # scale_x_continuous(limits = c(-3, 1.7),
    #                   breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  theme_bw()


ggplot(x17_cluster_counts,
       aes(x = cluster_no, y = n, fill = x17_fishing_low_profit)) +
  geom_bar(position="dodge", stat="identity", alpha = 0.8) +
  labs( x = "Clusters (1 and 4 are 'average')",
      y = "Total # of Fishers",
      title = "Fishing Effort in Offseason", 
      fill = "Fishing Effort (Per Week)", 
      caption = "Hypothesis: resistant fishers fish more") +
  geom_text(aes(label = n),position = position_dodge(0.9), vjust = 2, size = 2, color = "gray1")+
  theme_bw()
## Second figure will be another stacked barplot

```

This is rad! I'm going to code away at x18, and then do a little more interpreting. 
Notes:
- 

```{r}
x18_fishing_effort <- scaled_km_df %>% 
  filter(x18_fishing_high_profit %in% c(
    "Once or never",
"A few times",
"A few times per month",
"1-2 per week", 
"More than 1-2 times per week")) %>% 
  drop_na(x18_fishing_high_profit)

# basic counts

x18_counts <- x18_fishing_effort %>% 
  count(x18_fishing_high_profit)

x18_cluster_counts <- x18_fishing_effort %>% 
  group_by(cluster_no) %>% 
  count(x18_fishing_high_profit)
```

Let's do the same visualization for 18, as I did for 17. 

```{r}
ggplot(x18_cluster_counts,
       aes(x = cluster_no, y = n, fill = x18_fishing_high_profit)) +
  geom_bar(position="dodge", stat="identity", alpha = 0.8) +
  labs( x = "Clusters (1 and 4 are 'average')",
      y = "Total # of Fishers",
      title = "Fishing in High Season", 
      fill = "Frequency of Fishing", 
      caption = "Hypothesis: Angry fishers fish alot") +
  geom_text(aes(label = n),position = position_dodge(0.9), vjust = 2, size = 2, color = "gray1")+
  theme_bw()
```

##### Household Demographics (Question 7)


I'll first make a df that includes all of subquestions of Q7. 
```{r}
question_7_analysis <- scaled_km_df %>% 
  select(cluster_no, agree_mean, eng_mean, x70_hh_average_income, x7_gender, x7_age, x7_relationship, x7_education, household_size)
```


```{r}
q7_reordered <- question_7_analysis %>% 
  arrange(cluster_no)

fish_treeable <- q7_reordered %>% 
  select(cluster_no, x7_gender, x7_age, x7_relationship, x7_education, household_size) %>% 
  group_by(cluster_no)

treemap(fish_treeable,
        index= c("cluster_no", "household_size"),
vSize="household_size",
type="index")
```

OK, this hasn't worked out great. It works better with labels, huh. 


Let's try the same graph type we did earlier, comparing Clusters with..HH size 



Most households have 3, 4 or 5 members. Beyond that, there isn't a whole lot to gain from this comparison. 

Let's edit ages into several groups 

```{r}
binned_age <- question_7_analysis %>%
  mutate(agegroup = case_when(               x7_age >= 60  ~ '60+',
                                             x7_age >= 50  & x7_age <= 59 ~ '40-49',
                                             x7_age >= 40  & x7_age <= 49 ~ '40-49',
                                             x7_age >= 30  & x7_age <= 39 ~ '30-39',
                                             x7_age >= 20  & x7_age <= 29 ~ '20-29',
                                             x7_age <= 20 ~ "19 and Under"))

agegroup_counts <- binned_age %>% 
  drop_na(agegroup) %>% 
  group_by(cluster_no) %>% 
  count(agegroup)


```

I broke ages of respondents into 6 groups. This may be too many to visualize alongside all 4 Clusters. 

```{r}
ggplot(agegroup_counts,
       aes(x = cluster_no, y = n, fill = agegroup)) +
  geom_bar(position="fill", stat="identity", alpha = 0.8) +
  labs( x = "Clusters (1 and 4 are 'average')",
      y = "Fishers per Group",
      title = "What age are the Clusters?", 
      fill = "Age Group", 
      caption = "Hypothesis: Older fishers are more engaged") +
   geom_text(aes(label = n),position = position_fill(0.9), vjust = 2, size = 2, color = "gray1")+
   scale_fill_viridis(discrete = T) +
  theme_bw()
```
Ok, what do we see?! 

There were so many respondents under 20, wow! Perhaps I should be looking at 'household heads' if we really wanted this analysis of fisher ages. This is still interesting. 

Cluster 3 has a small proportion of older fishers, and a huge contingent of respondents under 20. About 50% of each cluster is 30 and under (and likewise 30 and over)


Let's do 1 more subsection of Q7. Binned HHS size? Or Relationship? I'll start with relationship. 

```{r}
relationship_counts <- question_7_analysis %>% 
  drop_na(x7_relationship) %>% 
  filter(x7_relationship != "Other") %>%
  filter(x7_relationship != "Other parent") %>%
  filter(x7_relationship != "Domestic help") %>%
  filter(x7_relationship != "Aquaintance") %>% 
  group_by(cluster_no) %>%
  count(x7_relationship)
```

```{r}
ggplot(relationship_counts,
       aes(x = cluster_no, y = n, fill = x7_relationship)) +
  geom_bar(position="fill", stat="identity", alpha = 0.8) +
  labs( x = "Clusters (1 and 4 are 'average')",
      y = "Fishers per Group",
      title = "Differences in Respondent Type", 
      fill = "Household Role of Respondent", 
      caption = "Hypothesis: Older fishers are more engaged") +
   geom_text(aes(label = n),position = position_fill(0.9), vjust = 2, size = 2, color = "gray1")+
   scale_fill_viridis(discrete = T) +
  theme_bw()
```
This is challenging because we're not likely seeing responses from the fisher of each house, rather we hear from whomever was home. If this happened to show spouses who were the fishers, vs. child fishers, etc... that would be more insightful. I'll bring this up to the group. 
