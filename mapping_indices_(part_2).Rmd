---
title: "Mapping Indices + Supplementary Cluster Material"
author: "Dylan Glave"
date: "1/28/2022"
output: html_document
---

```{r setup, include=FALSE, message=FALSE, warning= FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plotly)
library(plyr)
library(tidyverse)
library(here)
library(janitor)
library(tidyverse)
library(kableExtra)
library(knitr)
library(lavaanPlot)
library(lavaan)
library(naniar)
library(here)
library(scales)
library(foreign)
library(nnet)
library(reshape2)
library(vtable)
library(stargazer)
library(viridis)
library(NbClust)
library(car)
library(corrplot)
library(RColorBrewer)
library(forcats)
library(viridis)
library(data.table)
# library(treemap)
library(fmsb)

```

## R Markdown

This Document can be considered the "middle" of our analysis. The data has already been cleaned in `FF_cleaning_part_1` 
*For Maximum reproducibility, please run `FF_cleaning_part_1` before running this document, in case any changes have been made to the made to `scaled_sum.csv`.  This file has the cleaned, wrangled, and filtered data that apply to our Index Mapping, Cluster analysis, CFA all other visualizations and analysis.  


We start by reading in  in data via `scaled_sum`

```{r}
scaled_sum <- read.csv("scaled_sum.csv")
hhs_all_complete <- read_csv("hhs_all_complete.csv")
```


We want to include a point where all responses are "neutral" on our map of compliance behaviors
```{r}
neutral_point <- scaled_sum %>% 
filter(country == "NEUTRAL")
  
```


#### Mapping Indices

We now have one (x,y) point for each fisher observation, and can map them onto an X-Y plane of Agreement and Engagement. 


```{r}
  ggplot(data = scaled_sum,
                      aes(x = agree_mean, y = eng_mean)) +
   geom_point(color = "darkblue", size = 0.7, alpha = 0.4) +
  geom_point(data = neutral_point, aes(x = agree_mean, y = eng_mean),
             size = 8, color = "pink2") +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engagement and Agreement Index Mapping") +
#  scale_color_viridis(discrete = TRUE, option = "D") +
    # scale_x_continuous(limits = c(-3, 1.7),
    #                   breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  theme_bw() 

```
*Figure 1: A plot with the **neutral* fisher reported within the  spread of our Z-score-based indices. We see that Ms. Neutral is 1 SD below the mean in agreement. This location means that the majority of fishers at least somewhat agree with rules in place. Meanwhile, we see dense grouping between -0.5 and 0.5 on both axes. Quite a few fishers have the maximum score for agreement, while a smaller number meet the *ceiling* of engagement. 


Rare seems quite interested in addressing how fishers may be willing to *engage* more. 

Let's figure out the *counts* for those two ceiling locations. 

```{r}
agree_ceiling_counts <- scaled_sum %>% 
  group_by(agree_mean) %>% 
  count() %>% 
  arrange(!n)
```
The lowest score is -2.94 , N=1
Max score = 1.07, N = 124
As shown visually, many fishers agree with rules fully, far fewer engage as fully as possible. 


```{r}
eng_ceiling_counts <- scaled_sum %>% 
  group_by(eng_mean) %>% 
  count() %>% 
  arrange(!n)


ceiling_counts <- scaled_sum %>% 
  mutate(across(where(is.numeric), ~ round(., 2))) %>% 
  group_by(eng_mean, agree_mean) %>% 
  count() %>% 
  arrange(n)

```
*Engagement*
Max value = 1.6, N=25

Lowest value = -1.74, N=1 

Let's look at a density plot of all fishers
```{r}
ggplot(data = scaled_sum,
                      aes(x = agree_mean, y = eng_mean)) +
   geom_bin2d(bins = 20) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engagement and Agreement Index Mapping") +
#  scale_color_viridis(discrete = TRUE, option = "D") +
   scale_x_continuous(limits = c(-2.5, 1.7),
                     breaks = c(-2, -1, -0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.5)) +
   scale_y_continuous(limits = c(-1.5, 1.5),
                     breaks = c( -1, 0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.5)) +
  # guides(colour = guide_legend(override.aes = list(size=7))) +
  scale_fill_continuous(type = "viridis") +
  theme_bw()

```
*Figure 2: Density plot of the ~3200  responses. This allows us to see where points overlap, which was challenging in the first figure. We see a wide density field between -0.5 and 0.5 on the agreement axis, and -0.5 and 0.25 on the engagement axis; The densest group lies just below ) on both axes. We also find a dense bundle of fishery "leaders" right at (0,1.)  

Some of the modes:

1. (-0.15, 0.98) N=63
2. (=0.06, -0.46) N=59
3. (0.27, -0.23) N=52
4. (0.47, -0.65) N = 36





```{r}
 ggplot(data = scaled_sum,
       aes(x = agree_mean, y = eng_mean, color = country)) +
 geom_point(size = 0.7, alpha = 0.7) +
  theme_bw()
```
*When we look at countries, Honduras accounts for the majority of outliers (very low agreement.) Generally we see that each country includes a spread of fishers across the map of compliance attitudes; The Philippines has the most responses by a large margin.* 



### Below are some experiments with different-scales of the index. They are NOT part of the final analysis. 

Remaking indices without relative scales 

First, I'll use `raw_eng_mean` and `raw_agree_mean` to see the spread of fisher attitudes



- The "neutral point" is **(0.6, 6)**

I now want to see the stats of the raw means, vs. the scaled means. 
First, I make a sf called `four_means` that includes: `raw_agree_mean` `raw_eng_mean` `agree_mean` and `eng_mean`
```{r}

four_means <- scaled_sum %>% 
  select(raw_agree_mean, raw_eng_mean, agree_mean, eng_mean)


st(four_means)
```
*Raw Agreement*
Mean = 2.21
sd = .40
Range: 0.7-3
pct. 25 = 2
pct. 75 = 3

*Raw Engagement*
Mean = 0.6 (same as the neutral point)
sd = 0.52
Range: -0.8 - 2
pct. 25 = 0.2
pct. 75 = 1

Within Agreement, the average response is positive, a majority of folks respond 1 sd above Neutral. With Engagement, we see a a mean of 0.6, which is right at "neutral" and a more normal distribtuion from there. 

```{r}

mapping_63 <- scaled_sum %>% 
  drop_na(x63_fishing_in_reserve)


```



I want to see how many people said "yes" here: 

```{r}

counts_63 <- scaled_sum %>% 
  count(x63_fishing_in_reserve, country)

filtered_63 <- scaled_sum %>% 
  filter(x63_fishing_in_reserve == "1")

ggplot(data = filtered_63,
                      aes(x = agree_mean, y = eng_mean)) +
  geom_point(color = "darkblue", size = 1.2, alpha = 1,
             show.legend = TRUE) +
labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engange and Agreement of Admitted rule-breakers") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  theme_bw() 


```
*Figure 4: A graph of Agreement and Engagement measures, colored by responses of "Do you fish inside the reserve?" These fishers range * 

Question 63 asks if fishers break the rules, and fish in the reserve. This would be a classic measure of compliance (although self-reporting likely leads to a lower N of admitted non-compliers)

*138* fishers admitted that they fish in the reserve, while 2800 said they do not. The question we're left with is: What is different about folks who *admit* to breaking rules? These "Yes" rule-breakers are spread relatively evenly across all countries. 
Maybe they don't think there are sanctions, their community doesn't care about it

I'll do the same "rule-breaker" analysis, but against the question, "Out of 10 people in your community, how many peopleâ€¦Fished in the reserve in the last month"

`51b_fishers_reserves`

```{r}
breaking_rules <- 
  scaled_sum %>% 
  drop_na(x51b_fishers_reserves) %>% 
  select(x51b_fishers_reserves, eng_mean, agree_mean) %>% 
  filter(x51b_fishers_reserves != 82)

breaking_rules_1 <- ggplot(data = breaking_rules,
                      aes(x = agree_mean, y = eng_mean, color = x51b_fishers_reserves)) +
   geom_point(size = 0.7, alpha = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 6 Questions)",
      title = "Engagement and Agreement Index Mapping") +
#  scale_color_viridis(discrete = TRUE, option = "D") +
    scale_x_continuous(limits = c(-3, 1.7),
                      breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  scale_color_viridis( option = "D") +
  theme_bw() 

breaking_rules_1

more_breaking_rules <- 
  scaled_sum %>% 
  drop_na(x51b_fishers_reserves) %>% 
  select(x51b_fishers_reserves, eng_mean, agree_mean) %>% 
  filter(x51b_fishers_reserves != 82) %>% 
  filter(x51b_fishers_reserves >= 5)

breaking_rules_2 <- ggplot(data = more_breaking_rules,
                      aes(x = agree_mean, y = eng_mean, color = x51b_fishers_reserves)) +
   geom_point(size = 0.7, alpha = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 6 Questions)",
      title = "Engagement and Agreement Index Mapping") +
#  scale_color_viridis(discrete = TRUE, option = "D") +
    scale_x_continuous(limits = c(-3, 1.7),
                      breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  scale_color_viridis( option = "D") +
  theme_bw() 


breaking_rules_2 
```
What do I see here? 

Figure 5a. The left-most observations report that their neighbors all or mostly fish in the reserve. 
- We see the "10" response (everyone fishes in the reserve) in every section of the map. Very few in the fully-agreeing section, but some average fishers and highly-engaged fishers, respectively, perceive high rule-breaking in their fishing reserve. 
- The majority of responses say between 0 and 3 (out of 10) of their neighboring fishers fish within the reserve boundary.

Figure 5b.: *This is really interesting!* 

Here we only see responses of fishers who perceived that more than half of their community fishes in the no-take reserve. 
The very-low agreement observations are here, but many high-engagement fishers alsos ay that 10/10 neighbors fish in the reserve. 
Do they just think that practice is OK? Or might they be engaged to try and curb those efforts? Engaged folks maybe see the reality a bit better than those who are "hopeful" about conservation? fascinating. 






----
*Side note, there was curiosity if we could use a predictive model*
Potential Regression Model: 
[https://stats.idre.ucla.edu/r/dae/multinomial-logistic-regression/]


##### Statistical Summaries of Agreement and Engagement

Making some tables and graphs for Claudia + Rare: 


```{r}

hhs_scaled_character <- scaled_sum %>% 
  as.character(c(24:34))
  

engage_scaled_sum <- scaled_sum %>%
  select(24:28)
  
st(engage_scaled_sum)


agree_scaled_sum <- scaled_sum %>% 
  select(29:33)


st(agree_scaled_sum)
```

Great, here we see basic statistics for each component of these two indices! 




##### Measuring Brazil

*After a sensitivity analysis, we now include 756 Brazilian observations*

**Bottom-line: I did a sensitivity analysis on our indices on Brazil, where not all questions were asked (or documented.) This helped us finalize our indices, while questions about "knowledge of rules" or others may be very useful in further studies of Engagement and Agreement, or any other compliance behavior measure.** 

Previously, Brazil was excluded, due to question we included in the Agreement index (Q64) that was not asked in Brazil.

- There are 1592 observations from Brazil
- Brazilian fishers were not asked questions 62 and 64
- When we filter for our remaining Index questions, we end up with 


```{r}
brazil <- hhs_all_complete %>% 
  data.frame() %>% 
  clean_names() %>% 
  filter(country == "BRA") %>% 
  drop_na(x44_meeting_attendance, x45_leadership_position,
x48_enforcement_participation,  x53_encourage_regulations,
 x61g_fishing_change_behavior,
            x43_ma_benefits, x46_represent_interests,  x52_ma_benefit_5yrs, x53_encourage_regulations, x61a_current_regulations, x61f_rights_distribution_fair,
x30_trust_local_decision)


```
We retained `x30_trust_local_decision` but excluded `x67_reserve_boundry` which only 11 responses. Now our fuller indices include 819 observations from Brazil. 


####



**Per Steve and Chris' feedback, I am going to manually relevel the indices to a substantive (non-relative) scale, as shown below**

- Questions with *-1, 0, 1* will remain the same
- Questions on a *1-5* or *-2-2* scale will transform into a *-1, -0.5, 0, 0.5, 1* scale, and from there we will take the means. 

The following attempt to create a scaled (without Z-scores, is on hold as of 12/6/21. Contact D Glave to edit/advance)
```{r}
raw_index_leveling <- scaled_sum %>%
  select(country, x43_ma_benefits, x46_represent_interests, x52_ma_benefit_5yrs, x61a_current_regulations, x61f_rights_distribution_fair,x44_meeting_attendance, x45_leadership_position, x48_enforcement_participation, x53_encourage_regulations, x61g_fishing_change_behavior) %>%
mutate(x61f_rights_distribution_fair= (x61f_rights_distribution_fair-3)/2) %>% 
  mutate(x61a_current_regulations= (x61a_current_regulations-3)/2) %>% 
  mutate(x53_encourage_regulations= x53_encourage_regulations/2) %>% 
  mutate(x61g_fishing_change_behavior = (x61g_fishing_change_behavior-3)/2) %>% 
  mutate(eng_mean = mean(x44_meeting_attendance + x45_leadership_position + x48_enforcement_participation + x53_encourage_regulations + x61g_fishing_change_behavior)) %>% 
mutate(agree_mean = mean(x43_ma_benefits + x46_represent_interests + x52_ma_benefit_5yrs + x61a_current_regulations + x61f_rights_distribution_fair))
  

  
```

**NOTE: `raw_index_leveling` is a bit funky. We leveled each 1-5 response into [-1, -0.5, 0, 0.5, 1]**

We want to see a non-relative index measure, which leaves us with much less variation in possible outcomes (potential locations on an X-Y map.)
This tricky step happens because we don't want a step from "4" to "5" in likert to be the same as a step from "Neutral" to "Yes" on a binary question. But we sort of have to. 


Let's visualize this version


```{r}

ggplot(data = raw_index_leveling,
                      aes(x = agree_mean, y = eng_mean)) +
   # geom_point(color = "darkblue", size = 0.7, alpha = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engagement and Agreement Index Mapping") +
 geom_bin2d(bins = 50) +
   scale_color_viridis(discrete = TRUE, option = "D") +
   # scale_x_continuous(limits = c(-2.5, 1.7),
   #                   breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  theme_bw()

```



```{r}
# index_table_df <- scaled_sum %>% 
#   select(country, eng_mean, agree_mean) %>% 
#   rename("Relative Engagement Score" = eng_mean) %>% 
#   rename("Relative Agreement Score" = agree_mean)
# 
# 
# index_table_k <- head(index_table_df) %>% 
#   kable( format = "html", caption = "Engagement and Agreement Index Scores") %>% 
#   kable_styling(bootstrap_options = "striped", 
#                 full_width = F,
#                 position = "left") %>% 
# collapse_rows(columns = 3, valign = "middle")
# 
# index_table_k

```


```{r}
checking_43 <- scaled_km_df %>% 
  select(x43_ma_benefits, x43_scaled, cluster_no) %>% 
  filter(cluster_no %in% c('1', '4'))

checking_43_counts <- checking_43 %>% 
  group_by(cluster_no) %>% 
  count(x43_ma_benefits)
```

Per the metadata
*"43_ma_benefits: 1 (Yes), 0 (No), "*
100% of Cluster 1 sees No benefit
100% if Cluster 4 sees a benefit
In total, 6500 said no, 6200 said yes. 
Therefore, the means of exactly 1 and 0 are correct, because each clsuters has unanimous responses. 


##### Correlation plots with `corrplot()`

Another way that we check the validity of our indcides is with `corrplot`, we want to udnerstand how much differen components (questions) within each index correlate with one another. If 2 questions are nearly 100% correlated, we may want to remove one, as to not overweight a certain compliance idea. Likewise, if two questions had negative correlation, we would want to understand why.  

```{r}

 engagement_only <- scaled_sum %>% 
  select(24:28)

corrplot(cor(engagement_only), main = "Engagement Question Correlations")

```
When running a correlation of all the *Engagement* questions, we see very little correlation across the different questions. We see correlations around 0 and 0.3, with no negative correlations. We find the *largest* correlation between questions 45 and 48 (0.5). 


Let's do the same with agreement, and all compliance questions together. 


```{r}

corrplot(cor(agree_scaled_sum), main = "Agreement Question Correlations")
```

Here we see really similar results to the Engagement corrplot. There are no dark blue or large circles. Again, we see no negative correlation, a lot of results between 0 and 0.2. 61(f) (fairness of distribution) and 61(a) (benefit of current regulations) have a slightly lager correlation, at 0.5 


Let's look at agreement AND engagement. This will look messy at first. 




##### Confirmatory Factor Analysis

We were curious if our Clusters could be confirmed by a CFA. Mostly exploratory. 

```{r}
raw_index_leveling <- scaled_sum %>%
  select(country, x43_ma_benefits, x46_represent_interests, x52_ma_benefit_5yrs, x61a_current_regulations, x61f_rights_distribution_fair,x44_meeting_attendance, x45_leadership_position, x48_enforcement_participation, x53_encourage_regulations, x61g_fishing_change_behavior) %>%
mutate(x61f_rights_distribution_fair= (x61f_rights_distribution_fair-3)/2) %>% 
  mutate(x61a_current_regulations= (x61a_current_regulations-3)/2) %>% 
  mutate(x53_encourage_regulations= x53_encourage_regulations/2) %>% 
  mutate(x61g_fishing_change_behavior = (x61g_fishing_change_behavior-3)/2) %>% 
  mutate(eng_mean = mean(x44_meeting_attendance + x45_leadership_position + x48_enforcement_participation + x53_encourage_regulations + x61g_fishing_change_behavior)) %>% 
mutate(agree_mean = mean(x43_ma_benefits + x46_represent_interests + x52_ma_benefit_5yrs + x61a_current_regulations + x61f_rights_distribution_fair))


  
```


### Physical Cluster Analysis (How me create the scaled_km_df)

#### Cluster Analysis witk `NbClust` and K-means Clustering

After some exploratory work, we understood that a distance-based clustering method first. If possible we want to see common combinations of answers. 

The following doesn't show up in cluster analysis, but I'd be interested to see...


Basically, it's going to run 30 different ways of evaluating how many clusters it *thinks* exist, then tell you the breakdown of what they decide (e.g. "8 algorithms think that there should be 4 clusters").

`NbClust::NbClust()`

First I create a df with *only* the 10 columns of A/E questions, since this is all that I want to include in the `NbClust` K-means analysis. 
```{r}
agree_engage_only_scaled <- scaled_sum %>% 
  select(24:34) %>% 
  scale()

```



###### HERE is the  scaled, cluster analysis. 
```{r}
# number_est <- NbClust(agree_engage_only_scaled[], min.nc = 2, max.nc = 5, method = "kmeans")

agree_engage_only <- scaled_sum %>% 
  select()

set.seed(8)

 scaled_km <- kmeans(agree_engage_only_scaled, 4)


## The 4 means the amount of clusters we're looking at


  scaled_km
  

```
Below we can look at the "centers," although they are scaled numbers, I'll remake a table with the actual values 

```{r}
  cl_table_df <- data.frame(scaled_km$size,scaled_km$centers, scaled_km$cluster)
scaled_km_df_draft <- data.frame(scaled_sum, cluster_no = factor(scaled_km$cluster)) 
```


It's time to decide if there are 4 or 3 Clusters. 
When we pick 4, we see 2 overlapping clusters in the lower right. One looks to be a bit more agreeing, and includes the folks who are fully agreeing. 





**NOTE: `raw_index_leveling` is a bit funky. We leveled each 1-5 response into [-1, -0.5, 0, 0.5, 1]**

We want to see a non-relative index measure, which leaves us with much less variation in possible outcomes (potential locations on an X-Y map.)
This tricky step happens because we don't want a step from "4" to "5" in likert to be the same as a step from "Neutral" to "Yes" on a binary question. But we sort of have to. 


Let's visualize this version


```{r}
ggplot(data = raw_index_leveling,
                      aes(x = agree_mean, y = eng_mean)) +
   # geom_point(color = "darkblue", size = 0.7, alpha = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Engagement and Agreement Index Mapping") +
 geom_bin2d(bins = 50) +
   scale_color_viridis(discrete = TRUE, option = "D") +
   # scale_x_continuous(limits = c(-2.5, 1.7),
   #                   breaks = c(-2, -1, 0, 1, 1.5)) +
   # scale_y_continuous(limits = c(-1.5, 1.5),
   #                   breaks = c( -1, 0, 1, 1.5)) +
  guides(colour = guide_legend(override.aes = list(size=7))) +
  theme_bw()
```


Prepping only the agreement and engagement questions for the CFA

```{r}
agree_engage_leveled <- raw_index_leveling %>% 
  select(2:11) 

raw_index_leveling
```

######  Confirmatory Factor Analysis Model
using `agree_engage_only` df
```{r}

agree_engage_leveled

model1 <-  'f1  =~  x44_meeting_attendance +
                    x48_enforcement_participation +
                      x53_encourage_regulations + 
                    x61g_fishing_change_behavior +
             x43_ma_benefits + 
                    x52_ma_benefit_5yrs +
                    x61a_current_regulations +
                    x46_represent_interests +
              x61f_rights_distribution_fair'



fit <- cfa(model1, data = agree_engage_leveled, std.lv=TRUE)
summary(fit, standardized = TRUE, fit.measures = TRUE)


lavaan::modindices(fit, minimum.value = 10, sort = TRUE)
```
Taking notes on CFA 
- Std. all = "beta values" 
- We have pretty low 

Return to this link when I want to plot the fit model 
[https://www.youtube.com/watch?v=aQiFJcEWBLo]


The K-means clustering process is done, now I'll make some tables and a visualization of the A/E map, with Clusters as colors. This will begin to demonstrate how the fisher responses separate into different "types."


```{r}
 scaled_km_df <- data.frame(scaled_sum, cluster_no = factor(scaled_km$cluster)) %>% 
  mutate(cluster_no = recode_factor(cluster_no,
                                    "3" = "Committed", 
                                    "1" = "Wavering",
                                    "4" = "Supportive",
                                    "2" = "Resistant"))


cluster_summary_df <- scaled_km_df %>% 
  group_by(cluster_no) %>% 
  summarise(eng_mean = mean(eng_mean),
            agree_mean  = mean(agree_mean),
            x44_mean = mean(x44_meeting_attendance),
            x45_mean = mean(x45_leadership_position),
            x48_mean = mean(x48_enforcement_participation),
            x53_mean = mean(x53_encourage_regulations),
            x61g_mean = mean(x61g_fishing_change_behavior), 
            x43_mean =  mean(x43_ma_benefits),
            x46_mean = mean(x46_represent_interests),
           x52_mean = mean(x52_ma_benefit_5yrs),
           x61a_mean = mean(x61a_current_regulations),
           x61f_mean = mean(x61f_rights_distribution_fair),
           x30a_mean = mean(x30_trust_local_decision),
           x44_median = median(x44_meeting_attendance),
            x45_median = median(x45_leadership_position),
            x48_median = median(x48_enforcement_participation),
            x53_median = median(x53_encourage_regulations),
            x61g_median = median(x61g_fishing_change_behavior), 
            x43_median =  median(x43_ma_benefits),
            x46_median = median(x46_represent_interests),
           x52_median = median(x52_ma_benefit_5yrs),
           x61a_median = median(x61a_current_regulations),
           x61f_median = median(x61f_rights_distribution_fair),
            x30a_median = median(x30_trust_local_decision)) %>% 
  mutate(across(where(is.numeric), ~ round(., 2)))
## Here, the last line of code rounds to the second decimal 

cluster_medians <- cluster_summary_df %>% 
  select(1, 14:23) 

cl_mean_graphable_df <- cluster_summary_df %>% 
  select(eng_mean, agree_mean, cluster_no)



scaled_cluster_counts <- scaled_km_df %>% 
  count(cluster_no)


ggplot() +
  geom_point(data = scaled_km_df,
       aes(x = agree_mean, y = eng_mean,
           color = cluster_no),
           size = 0.7, alpha = 0.7) +
   geom_point(data = cl_mean_graphable_df,
             aes(x = agree_mean, y = eng_mean,
          color = cluster_no),
           size = 6, shape = "triangle", show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mapping Clusters",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))
```


Here is the CSV of our complete dataset, including Clusters, renamed with their titles.
```{r}
write.csv(scaled_km_df, "scaled_km_df.csv")
```


#### Cluster-Specific Maps, including densities, country-colored, and stats


*df for each Cluster*
```{r, include=FALSE}

cluster_1_df <- scaled_km_df %>% 
  filter(cluster_no == "1")

mean(cluster_1_df$eng_mean)
mean(cluster_1_df$agree_mean)
median(cluster_1_df$eng_mean)
median(cluster_1_df$agree_mean)

cluster_2_df <- scaled_km_df %>% 
  filter(cluster_no == "2")

mean(cluster_2_df$eng_mean)
mean(cluster_2_df$agree_mean)
median(cluster_2_df$eng_mean)
median(cluster_2_df$agree_mean)

cluster_3_df <- scaled_km_df %>% 
  filter(cluster_no == "3")

c_1_e_m <- mean(cluster_3_df$eng_mean)
mean(cluster_3_df$agree_mean)
median(cluster_3_df$eng_mean)
median(cluster_3_df$agree_mean)

cluster_4_df <- scaled_km_df %>% 
  filter(cluster_no == "4")

mean(cluster_4_df$eng_mean)
mean(cluster_4_df$agree_mean)

median(cluster_4_df$eng_mean)
median(cluster_4_df$agree_mean)

cluster_5_df <- scaled_km_df %>% 
  filter(cluster_no == "5")

mean(cluster_5_df$eng_mean)
mean(cluster_5_df$agree_mean)

median(cluster_5_df$eng_mean)
median(cluster_5_df$agree_mean)
```



##### Cluster-specific maps

Cluster 1
```{r}


c_1_mean <- cluster_1_df %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))

ggplot() +
  geom_point(data = cluster_1_df,
       aes(x = agree_mean, y = eng_mean,
           color = country),
           size = 1) +
  geom_point(data = c_1_mean,
             aes(x = agree_mean, y = eng_mean), 
           size = 6, shape = "triangle", alpha = 0.7, show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Cluster 1", 
      color = "Country") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))


 ggplot(data = cluster_1_df,
       aes(x = agree_mean, y = eng_mean)) +
  geom_bin2d(bins = 20) +
  scale_fill_continuous(type = "viridis") +
  theme_bw() +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Density of Cluster 1",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, -0.5, 0, 0.5, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, -0.5, 0, 0.5, 1, 2))





cluster_1_country_counts <- cluster_1_df %>% 
  count(country)

```
*Figure 7a: Cluster 1 centers at (-0.13,-0.23) and accounts for average fishers who don't see benefits from Managed-Access. They respond nuetrally or in disagreement to question 43, and therefore have an agreement ceiling of 1.8*


*7b: The density plot shows us that the several hundred observations lie near (0, -0.5) (of 1154 total.) These fishers have are generally disengaged and have average agreement. The exception is their view of MA benefits*


Notes: 
Agreement ranges -1.2 to 0.8 (ceiling) and engagement ranges -1.4 to 0.9, with a soft ceiling at 0.5; only a handful of observations are included above 0.5 on the Y-axis. 


*Country Note*
163 from Brazil seems high.
23 from Honduras seems low. 
873 from PHL


Cluster 2 
```{r}

c_2_mean <- cluster_2_df %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))

c2_country_counts <- cluster_2_df %>% 
  count(country)

ggplot() +
  geom_point(data = cluster_2_df,
       aes(x = agree_mean, y = eng_mean,
           color = country),
           size = 1) +
  geom_point(data = c_2_mean,
             aes(x = agree_mean, y = eng_mean), 
           size = 6, shape = "triangle", alpha = 0.7, show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Cluster 2", 
      color = "Country") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))

ggplot(data = cluster_2_df,
       aes(x = agree_mean, y = eng_mean)) +
  geom_bin2d(bins = 20) +
  scale_fill_continuous(type = "viridis") +
  theme_bw() +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Density of Cluster 2",
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2))
```
*Figure 8a: Cluster 2 are the resistant fishers. A handful of them are quite engaged, but cannot fit in another cluster, due simply to their disagreement below -1. The cluster has a mean of (-0.87, -0.42.) It also has the largest range of any cluster. Agreement ranges between -2.76 and 0.1. Meanwhile, engagement ranges from -1.55 to 1.4. N = 741*.

*8b: This is a smaller cluster, with a hotspot at (-1, -0.5) and just below (on the Y-axis.) * 

The Neutral fisher is in this cluster, interestingly. 

Country Notes
- Many of the super-unengaged  (bottom of graph)fishers come from Brazil. 
It's possible that there are less meetings to go to; 234 total in the cluster
- Many super-disagreeing fishers come from Honduras, 135 total
- 224 from Philippines, which is only 8% of the 2559 total. 

40% of Honduras and Brazil are in this resistant cluster

- BRA 234 of 573 (41%)
- HND 135 of 339 (40%)
- IDN 46 of 146 (32%)
- FSM 15 of 23 (65%)
- MOZ 83 of 669 (12%) Nice work MOZ
- PHL  of 2559 (9%)
- PLW  of 37 (8%)



Cluster 3
```{r}

c_3_mean <- cluster_3_df %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))

c3_country_counts <- cluster_3_df %>% 
  count(country)


ggplot() +
  geom_point(data = cluster_3_df,
       aes(x = agree_mean, y = eng_mean,
           color = country),
           size = 1) +
  geom_point(data = c_3_mean,
             aes(x = agree_mean, y = eng_mean), 
           size = 6, shape = "triangle", alpha = 0.6, show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Cluster 3", 
      color = "Country") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))



# Density time
ggplot(data = cluster_3_df,
       aes(x = agree_mean, y = eng_mean)) +
  geom_bin2d(bins = 20) +
  scale_fill_continuous(type = "viridis") +
  theme_bw() +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Density of Cluster 3") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2))

```
*Figure 10: Cluster 3 is the commitment cluster; they agree with fishery conservation and participate in local management. A few of them are below the mean for engagement, and some moderately disagreeing fishers also find themselves here. With a mean of (0.30, 0.87,) these respondents stand out as the attitudes that Rare wants to see (after campaign implementation.) N = 1002* 

Engagement ranges -0.28 (only 1% are below 0) to 1.59.
Agreement ranges -1 to 1. 1/3 of all observations are below 0
...We see that engagement is what separates the "committed" folks from the pack. 

Highest density lies at (0,1.) However, we see a vertical density at 0.5 agreement, ranging from 0.5 to 1.25. The grand majority of the cluster lies in this range, with smaller groups at the maximum scores for engagement and agreement. Reminder that to have an engagement "maximum" these people volunteer for enforcement, attend meetings, and have some type of leadership role. 

Country Notes (hypothesis= PHL dominates)
- 311 from MOZ (that's a lot for them, 46% of the 669!)
PHL is equally proportioned, while Brazil is extremely low, as is Honduras.


- BRA 30 of 573 (5%)
- HND 25 of 339 (7%)
- IDN 37 of 146 (25%)
- FSM 2 of 23 (8%)
- MOZ 311 of 669 (46%)
- PHL 582 of 2559 (34%)
- PLW 15 of 37 (41%)




Cluster 4

```{r}

c_4_mean <- cluster_4_df %>% 
  summarise(eng_mean = mean(eng_mean),
                  agree_mean  = mean(agree_mean))


c4_country_counts <- cluster_4_df %>% 
  count(country)


ggplot() +
  geom_point(data = cluster_4_df,
       aes(x = agree_mean, y = eng_mean,
           color = country),
           size = 1) +
  geom_point(data = c_4_mean,
             aes(x = agree_mean, y = eng_mean), 
           size = 6, shape = "triangle", alpha = 0.6, show.legend = FALSE) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Cluster 4", 
      color = "Country") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
   guides(colour = guide_legend(override.aes = list(size=7)))

ggplot(data = cluster_4_df,
       aes(x = agree_mean, y = eng_mean)) +
  geom_bin2d(bins = 20) +
  scale_fill_continuous(type = "viridis") +
  theme_bw() +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Density of Cluster 4") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2))

```
*11a: Only a few fishers are below -1 engagement, while agreeing this much. They agree more(?) that Cluster 1, but otherwise look close to identical. Mean = (0.314, -0.18) N = 1554, largest group.* 

*11b: There is a sparse line of these unengaged fishers who agree completely with rules. The majority though find themselves between 0 and 1 for agreement (pretty high!) and between -0.5 and 0.5 for engagement. Most of those are below 0. Density is pretty unimodal*

Country Notes
- BRA 246 of 573 (37%)
- HND 156 of 339 (46%)
- IDN 49 of 146 (33%)
- MOZ 210 of 669 (31%)
- PHL 874 of 2559 (34)
- PLW 19 of 37 (51%)

2/3 are below neutral engagement. 





##### Country-specific cluster maps 

Philippines:
```{r}

cl_phil <- scaled_km_df %>% 
  filter(country == "PHL")


ggplot(cl_phil,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Phillipines Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_phil_count <- 
  cl_phil %>% 
  count(cluster_no)

```

Eye Test
- Very few observations below -1 in agreement. 
- Clear mix across C1 and C4. 
- Strong contingency of C3 (committed fishers)


Indonesia: 

```{r}

cl_indo <- scaled_km_df %>% 
  filter(country == "IDN")


ggplot(cl_indo,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Indonesia Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))


cl_indo_count <- 
  cl_indo %>% 
  count(cluster_no)

```

Eye-Test
- Small N, why? 
- Barely any dots in C1, the average fishers who see no benefit to MA



Honduras
```{r}

cl_honduras <- scaled_km_df %>% 
  filter(country == "HND")

hnd_counts <- cl_honduras %>% 
  count(cluster_no)


ggplot(cl_honduras,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Honduras Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_hond_count <- 
  cl_honduras %>% 
  count(cluster_no)
```

Eye Test
- Huge spread of resistant fishers
- Very few from Cluster 1
- Includes some disagreeing folks who sit well above neutral engagement (creative fishers.)
- Even the Average fishers here are more engaged than other countries


```{r}

cl_micro <- scaled_km_df %>% 
  filter(country == "FSM")


ggplot(cl_micro,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Micronesia Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_micro_count <- 
  cl_micro %>% 
  count(cluster_no)
```



Mozambique

```{r}

cl_moz <- scaled_km_df %>% 
  filter(country == "MOZ")


ggplot(cl_moz,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 6 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Mozambique Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_moz_count <- 
  cl_moz %>% 
  count(cluster_no)
```

Eye-test
- Mozambique is the most committed country.
How'd this come to be? Is MA better than previous management? 

```{r}

cl_brazil <- scaled_km_df %>% 
  filter(country == "BRA")

bra_counts <- cl_brazil %>% 
  count(cluster_no)


ggplot(cl_brazil,
       aes(x = agree_mean, y = eng_mean, color = cluster_no)) +
  geom_point(size = 0.7) +
  labs( x = "Agreement (Scaled across 5 Questions)",
      y = "Engagement (Scaled across 5 Questions)",
      title = "Brazil Cluster Map", 
      color = "Cluster") +
  scale_x_continuous(limits = c(-3, 2),
                     breaks = c(-2, -1, 0, 1, 2)) +
   scale_y_continuous(limits = c(-1.5, 2),
                     breaks = c( -1, 0, 1, 2)) +
  guides(colour = guide_legend(override.aes = list(size=7)))

cl_bra_count <- 
  cl_brazil %>% 
  count(cluster_no)
```


At first it looks like a full spread, but the majority lie between 0 and -1 engagement, and from there range widely across agreement. 


##### A side-step to refine our index: Comparing subquestions in x30 (Trusting different groups)

We're adding 1 question to the Agreement index, either `x30_trust_local_decision` or `30_trust_regional_decision`

I'll run a `corplot` how the two questions compare

```{r}
x30_compared <- 
  hhs_complete_filtered %>% 
  select(x30_trust_local_decision, x30_trust_regional_decision) %>% 
  drop_na()

corrplot(cor(x30_compared))

```

alright, they're highly correlated, we're going to stick with "local decision-makers"


